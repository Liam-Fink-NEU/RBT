{"ast":null,"code":"\"use strict\";\n\nconst vm = require(\"vm\");\n\nconst webIDLConversions = require(\"webidl-conversions\");\n\nconst {\n  CSSStyleDeclaration\n} = require(\"cssstyle\");\n\nconst {\n  Performance: RawPerformance\n} = require(\"w3c-hr-time\");\n\nconst notImplemented = require(\"./not-implemented\");\n\nconst {\n  define,\n  mixin\n} = require(\"../utils\");\n\nconst Element = require(\"../living/generated/Element\");\n\nconst EventTarget = require(\"../living/generated/EventTarget\");\n\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\n\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\n\nconst cssom = require(\"cssom\");\n\nconst postMessage = require(\"../living/post-message\");\n\nconst DOMException = require(\"domexception\");\n\nconst {\n  btoa,\n  atob\n} = require(\"abab\");\n\nconst idlUtils = require(\"../living/generated/utils\");\n\nconst createXMLHttpRequest = require(\"../living/xmlhttprequest\");\n\nconst createFileReader = require(\"../living/generated/FileReader\").createInterface;\n\nconst createWebSocket = require(\"../living/generated/WebSocket\").createInterface;\n\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\n\nconst BarProp = require(\"../living/generated/BarProp\");\n\nconst Document = require(\"../living/generated/Document\");\n\nconst External = require(\"../living/generated/External\");\n\nconst Navigator = require(\"../living/generated/Navigator\");\n\nconst Performance = require(\"../living/generated/Performance\");\n\nconst Screen = require(\"../living/generated/Screen\");\n\nconst Storage = require(\"../living/generated/Storage\");\n\nconst createAbortController = require(\"../living/generated/AbortController\").createInterface;\n\nconst createAbortSignal = require(\"../living/generated/AbortSignal\").createInterface;\n\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\n\nconst {\n  matchesDontThrow\n} = require(\"../living/helpers/selectors\");\n\nconst {\n  fireAnEvent\n} = require(\"../living/helpers/events\");\n\nconst SessionHistory = require(\"../living/window/SessionHistory\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\n\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nconst defaultStyleSheet = require(\"./default-stylesheet\");\n\nlet parsedDefaultStyleSheet; // NB: the require() must be after assigning `module.exports` because this require() is circular\n// TODO: this above note might not even be true anymore... figure out the cycle and document it, or clean up.\n\nmodule.exports = Window;\n\nconst dom = require(\"../living\");\n\ndom.Window = Window; // NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\n\nfunction Window(options) {\n  EventTarget.setup(this);\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n  const window = this;\n  mixin(window, WindowEventHandlersImpl.prototype);\n  mixin(window, GlobalEventHandlersImpl.prototype);\n\n  this._initGlobalEvents(); ///// INTERFACES FROM THE DOM\n  // TODO: consider a mode of some sort where these are not shared between all DOM instances\n  // It'd be very memory-expensive in most cases, though.\n\n\n  for (const name in dom) {\n    Object.defineProperty(window, name, {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: dom[name]\n    });\n  } ///// PRIVATE DATA PROPERTIES\n\n\n  this._resourceLoader = options.resourceLoader; // vm initialization is deferred until script processing is activated\n\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, {\n    get: () => this._globalProxy\n  });\n  let timers = Object.create(null);\n  let animationFrameCallbacks = Object.create(null); // List options explicitly to be clear which are passed through\n\n  this._document = Document.create([], {\n    options: {\n      parsingMode: options.parsingMode,\n      contentType: options.contentType,\n      encoding: options.encoding,\n      cookieJar: options.cookieJar,\n      url: options.url,\n      lastModified: options.lastModified,\n      referrer: options.referrer,\n      concurrentNodeIterators: options.concurrentNodeIterators,\n      parseOptions: options.parseOptions,\n      defaultView: this._globalProxy,\n      global: this\n    }\n  }); // https://html.spec.whatwg.org/#session-history\n\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n  this._virtualConsole = options.virtualConsole;\n  this._runScripts = options.runScripts;\n\n  if (this._runScripts === \"outside-only\" || this._runScripts === \"dangerously\") {\n    contextifyWindow(this);\n  } // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n\n\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null; // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n\n  this._length = 0;\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota; // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n\n  if (options.commonForOrigin && options.commonForOrigin[this._document.origin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [this._document.origin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[this._document.origin]; ///// WEB STORAGE\n\n  this._localStorage = Storage.create([], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create([], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  }); ///// GETTERS\n\n  const locationbar = BarProp.create();\n  const menubar = BarProp.create();\n  const personalbar = BarProp.create();\n  const scrollbars = BarProp.create();\n  const statusbar = BarProp.create();\n  const toolbar = BarProp.create();\n  const external = External.create();\n  const navigator = Navigator.create([], {\n    userAgent: this._resourceLoader._userAgent\n  });\n  const performance = Performance.create([], {\n    rawPerformance\n  });\n  const screen = Screen.create();\n  define(this, {\n    get length() {\n      return window._length;\n    },\n\n    get window() {\n      return window._globalProxy;\n    },\n\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n\n    get frames() {\n      return window._globalProxy;\n    },\n\n    get self() {\n      return window._globalProxy;\n    },\n\n    get parent() {\n      return window._parent;\n    },\n\n    get top() {\n      return window._top;\n    },\n\n    get document() {\n      return window._document;\n    },\n\n    get external() {\n      return external;\n    },\n\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n\n    get navigator() {\n      return navigator;\n    },\n\n    get locationbar() {\n      return locationbar;\n    },\n\n    get menubar() {\n      return menubar;\n    },\n\n    get personalbar() {\n      return personalbar;\n    },\n\n    get scrollbars() {\n      return scrollbars;\n    },\n\n    get statusbar() {\n      return statusbar;\n    },\n\n    get toolbar() {\n      return toolbar;\n    },\n\n    get performance() {\n      return performance;\n    },\n\n    get screen() {\n      return screen;\n    },\n\n    get localStorage() {\n      if (this._document.origin === \"null\") {\n        throw new DOMException(\"localStorage is not available for opaque origins\", \"SecurityError\");\n      }\n\n      return this._localStorage;\n    },\n\n    get sessionStorage() {\n      if (this._document.origin === \"null\") {\n        throw new DOMException(\"sessionStorage is not available for opaque origins\", \"SecurityError\");\n      }\n\n      return this._sessionStorage;\n    }\n\n  });\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy); ///// METHODS for [ImplicitThis] hack\n  // See https://lists.w3.org/Archives/Public/public-script-coord/2015JanMar/0109.html\n\n  this.addEventListener = this.addEventListener.bind(this);\n  this.removeEventListener = this.removeEventListener.bind(this);\n  this.dispatchEvent = this.dispatchEvent.bind(this); ///// METHODS\n\n  let latestTimerId = 0;\n  let latestAnimationFrameCallbackId = 0;\n\n  this.setTimeout = function (fn, ms) {\n    const args = [];\n\n    for (let i = 2; i < arguments.length; ++i) {\n      args[i - 2] = arguments[i];\n    }\n\n    return startTimer(window, setTimeout, clearTimeout, ++latestTimerId, fn, ms, timers, args);\n  };\n\n  this.setInterval = function (fn, ms) {\n    const args = [];\n\n    for (let i = 2; i < arguments.length; ++i) {\n      args[i - 2] = arguments[i];\n    }\n\n    return startTimer(window, setInterval, clearInterval, ++latestTimerId, fn, ms, timers, args);\n  };\n\n  this.clearInterval = stopTimer.bind(this, timers);\n  this.clearTimeout = stopTimer.bind(this, timers);\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = fn => {\n      const timestamp = rawPerformance.now() - windowInitialized;\n      const fps = 1000 / 60;\n      return startTimer(window, setTimeout, clearTimeout, ++latestAnimationFrameCallbackId, fn, fps, animationFrameCallbacks, [timestamp]);\n    };\n\n    this.cancelAnimationFrame = stopTimer.bind(this, animationFrameCallbacks);\n  }\n\n  this.__stopAllTimers = function () {\n    stopAllTimers(timers);\n    stopAllTimers(animationFrameCallbacks);\n    latestTimerId = 0;\n    latestAnimationFrameCallbackId = 0;\n    timers = Object.create(null);\n    animationFrameCallbacks = Object.create(null);\n  };\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n\n    impl._selectedness = selected;\n    return option;\n  }\n\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image() {\n    const img = window._document.createElement(\"img\");\n\n    const impl = idlUtils.implForWrapper(img);\n\n    if (arguments.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(arguments[0]));\n    }\n\n    if (arguments.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(arguments[1]));\n    }\n\n    return img;\n  }\n\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n  this.postMessage = postMessage;\n\n  this.atob = function (str) {\n    const result = atob(str);\n\n    if (result === null) {\n      throw new DOMException(\"The string to be decoded contains invalid characters.\", \"InvalidCharacterError\");\n    }\n\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n\n    if (result === null) {\n      throw new DOMException(\"The string to be encoded contains invalid characters.\", \"InvalidCharacterError\");\n    }\n\n    return result;\n  };\n\n  this.FileReader = createFileReader({\n    window: this\n  }).interface;\n  this.WebSocket = createWebSocket({\n    window: this\n  }).interface;\n  const AbortSignalWrapper = createAbortSignal({\n    window: this\n  });\n  this.AbortSignal = AbortSignalWrapper.interface;\n  this.AbortController = createAbortController({\n    AbortSignal: AbortSignalWrapper\n  }).interface;\n  this.XMLHttpRequest = createXMLHttpRequest(this); // TODO: necessary for Blob and FileReader due to different-globals weirdness; investigate how to avoid this.\n\n  this.ArrayBuffer = ArrayBuffer;\n  this.Int8Array = Int8Array;\n  this.Uint8Array = Uint8Array;\n  this.Uint8ClampedArray = Uint8ClampedArray;\n  this.Int16Array = Int16Array;\n  this.Uint16Array = Uint16Array;\n  this.Int32Array = Int32Array;\n  this.Uint32Array = Uint32Array;\n  this.Float32Array = Float32Array;\n  this.Float64Array = Float64Array;\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves.\n    const currentWindow = this;\n\n    (function windowCleaner(windowToClean) {\n      for (let i = 0; i < windowToClean.length; i++) {\n        windowCleaner(windowToClean[i]);\n      } // We\"re already in our own window.close().\n\n\n      if (windowToClean !== currentWindow) {\n        windowToClean.close();\n      }\n    })(this); // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n\n\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n\n        this._document.close();\n      }\n\n      const doc = idlUtils.implForWrapper(this._document);\n\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n\n      delete this._document;\n    }\n\n    this.__stopAllTimers();\n\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt) {\n    elt = Element.convert(elt);\n    const declaration = new CSSStyleDeclaration();\n    const {\n      forEach,\n      indexOf\n    } = Array.prototype;\n    const {\n      style\n    } = elt;\n\n    function setPropertiesFromRule(rule) {\n      if (!rule.selectorText) {\n        return;\n      }\n\n      const cssSelectorSplitRe = /((?:[^,\"']|\"[^\"]*\"|'[^']*')+)/;\n      const selectors = rule.selectorText.split(cssSelectorSplitRe);\n      let matched = false;\n\n      for (const selectorText of selectors) {\n        if (selectorText !== \"\" && selectorText !== \",\" && !matched && matchesDontThrow(elt, selectorText)) {\n          matched = true;\n          forEach.call(rule.style, property => {\n            declaration.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n          });\n        }\n      }\n    }\n\n    function readStylesFromStyleSheet(sheet) {\n      forEach.call(sheet.cssRules, rule => {\n        if (rule.media) {\n          if (indexOf.call(rule.media, \"screen\") !== -1) {\n            forEach.call(rule.cssRules, setPropertiesFromRule);\n          }\n        } else {\n          setPropertiesFromRule(rule);\n        }\n      });\n    }\n\n    if (!parsedDefaultStyleSheet) {\n      parsedDefaultStyleSheet = cssom.parse(defaultStyleSheet);\n    }\n\n    readStylesFromStyleSheet(parsedDefaultStyleSheet);\n    forEach.call(elt.ownerDocument.styleSheets, readStylesFromStyleSheet);\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n    return declaration;\n  }; // The captureEvents() and releaseEvents() methods must do nothing\n\n\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {}; ///// PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  }); ///// INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, window.document);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, window.document);\n\n        if (!idlUtils.implForWrapper(window._document)._pageShowingFlag) {\n          idlUtils.implForWrapper(window._document)._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, {\n            persisted: false\n          }, window.document);\n        }\n      });\n    }\n  });\n}\n\nObject.setPrototypeOf(Window, EventTarget.interface);\nObject.setPrototypeOf(Window.prototype, EventTarget.interface.prototype);\nObject.defineProperty(Window.prototype, Symbol.toStringTag, {\n  value: \"Window\",\n  writable: false,\n  enumerable: false,\n  configurable: true\n});\n\nfunction startTimer(window, startFn, stopFn, timerId, callback, ms, timerStorage, args) {\n  if (!window || !window._document) {\n    return undefined;\n  }\n\n  if (typeof callback !== \"function\") {\n    const code = String(callback);\n    callback = window._globalProxy.eval.bind(window, code + `\\n//# sourceURL=${window.location.href}`);\n  }\n\n  const oldCallback = callback;\n\n  callback = () => {\n    try {\n      oldCallback.apply(window._globalProxy, args);\n    } catch (e) {\n      reportException(window, e, window.location.href);\n    }\n  };\n\n  const res = startFn(callback, ms);\n  timerStorage[timerId] = [res, stopFn];\n  return timerId;\n}\n\nfunction stopTimer(timerStorage, id) {\n  const timer = timerStorage[id];\n\n  if (timer) {\n    // Need to .call() with undefined to ensure the thisArg is not timer itself\n    timer[1].call(undefined, timer[0]);\n    delete timerStorage[id];\n  }\n}\n\nfunction stopAllTimers(timers) {\n  Object.keys(timers).forEach(key => {\n    const timer = timers[key]; // Need to .call() with undefined to ensure the thisArg is not timer itself\n\n    timer[1].call(undefined, timer[0]);\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n  const documentImpl = idlUtils.implForWrapper(window._document);\n  documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n}","map":{"version":3,"sources":["/Users/liamfink/class-app/node_modules/jsdom/lib/jsdom/browser/Window.js"],"names":["vm","require","webIDLConversions","CSSStyleDeclaration","Performance","RawPerformance","notImplemented","define","mixin","Element","EventTarget","PageTransitionEvent","namedPropertiesWindow","cssom","postMessage","DOMException","btoa","atob","idlUtils","createXMLHttpRequest","createFileReader","createInterface","createWebSocket","WebSocketImpl","implementation","BarProp","Document","External","Navigator","Screen","Storage","createAbortController","createAbortSignal","reportException","matchesDontThrow","fireAnEvent","SessionHistory","GlobalEventHandlersImpl","WindowEventHandlersImpl","defaultStyleSheet","parsedDefaultStyleSheet","module","exports","Window","dom","options","setup","rawPerformance","windowInitialized","now","window","prototype","_initGlobalEvents","name","Object","defineProperty","enumerable","configurable","writable","value","_resourceLoader","resourceLoader","_globalProxy","implForWrapper","wrapperSymbol","get","timers","create","animationFrameCallbacks","_document","parsingMode","contentType","encoding","cookieJar","url","lastModified","referrer","concurrentNodeIterators","parseOptions","defaultView","global","_sessionHistory","document","_URL","stateObject","_virtualConsole","virtualConsole","_runScripts","runScripts","contextifyWindow","_parent","_top","_frameElement","_length","_pretendToBeVisual","pretendToBeVisual","_storageQuota","storageQuota","commonForOrigin","origin","_commonForOrigin","localStorageArea","Map","sessionStorageArea","windowsInSameOrigin","_currentOriginData","_localStorage","associatedWindow","storageArea","type","documentURI","_sessionStorage","locationbar","menubar","personalbar","scrollbars","statusbar","toolbar","external","navigator","userAgent","_userAgent","performance","screen","length","frameElement","wrapperForImpl","frames","self","parent","top","location","_location","history","_history","localStorage","sessionStorage","initializeWindow","addEventListener","bind","removeEventListener","dispatchEvent","latestTimerId","latestAnimationFrameCallbackId","setTimeout","fn","ms","args","i","arguments","startTimer","clearTimeout","setInterval","clearInterval","stopTimer","requestAnimationFrame","timestamp","fps","cancelAnimationFrame","__stopAllTimers","stopAllTimers","Option","text","defaultSelected","selected","undefined","DOMString","boolean","option","createElement","impl","setAttributeNS","_selectedness","HTMLOptionElement","Image","img","String","HTMLImageElement","Audio","src","audio","HTMLAudioElement","str","result","FileReader","interface","WebSocket","AbortSignalWrapper","AbortSignal","AbortController","XMLHttpRequest","ArrayBuffer","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","stop","manager","_requestManager","close","currentWindow","windowCleaner","windowToClean","_eventListeners","body","innerHTML","doc","cleanUpWindow","getComputedStyle","elt","convert","declaration","forEach","indexOf","Array","style","setPropertiesFromRule","rule","selectorText","cssSelectorSplitRe","selectors","split","matched","call","property","setProperty","getPropertyValue","getPropertyPriority","readStylesFromStyleSheet","sheet","cssRules","media","parse","ownerDocument","styleSheets","captureEvents","releaseEvents","wrapConsoleMethod","method","emit","console","assert","clear","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeEnd","trace","warn","notImplementedMethod","status","devicePixelRatio","innerWidth","innerHeight","outerWidth","outerHeight","pageXOffset","pageYOffset","screenX","screenLeft","screenY","screenTop","scrollX","scrollY","alert","blur","confirm","focus","moveBy","moveTo","open","print","prompt","resizeBy","resizeTo","scroll","scrollBy","scrollTo","process","nextTick","readyState","_pageShowingFlag","persisted","setPrototypeOf","Symbol","toStringTag","startFn","stopFn","timerId","callback","timerStorage","code","eval","href","oldCallback","apply","e","res","id","timer","keys","key","isContext","createContext","documentImpl","_defaultView","runInContext"],"mappings":"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","sourcesContent":["\"use strict\";\nconst vm = require(\"vm\");\nconst webIDLConversions = require(\"webidl-conversions\");\nconst { CSSStyleDeclaration } = require(\"cssstyle\");\nconst { Performance: RawPerformance } = require(\"w3c-hr-time\");\nconst notImplemented = require(\"./not-implemented\");\nconst { define, mixin } = require(\"../utils\");\nconst Element = require(\"../living/generated/Element\");\nconst EventTarget = require(\"../living/generated/EventTarget\");\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\nconst cssom = require(\"cssom\");\nconst postMessage = require(\"../living/post-message\");\nconst DOMException = require(\"domexception\");\nconst { btoa, atob } = require(\"abab\");\nconst idlUtils = require(\"../living/generated/utils\");\nconst createXMLHttpRequest = require(\"../living/xmlhttprequest\");\nconst createFileReader = require(\"../living/generated/FileReader\").createInterface;\nconst createWebSocket = require(\"../living/generated/WebSocket\").createInterface;\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\nconst BarProp = require(\"../living/generated/BarProp\");\nconst Document = require(\"../living/generated/Document\");\nconst External = require(\"../living/generated/External\");\nconst Navigator = require(\"../living/generated/Navigator\");\nconst Performance = require(\"../living/generated/Performance\");\nconst Screen = require(\"../living/generated/Screen\");\nconst Storage = require(\"../living/generated/Storage\");\nconst createAbortController = require(\"../living/generated/AbortController\").createInterface;\nconst createAbortSignal = require(\"../living/generated/AbortSignal\").createInterface;\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\nconst { matchesDontThrow } = require(\"../living/helpers/selectors\");\nconst { fireAnEvent } = require(\"../living/helpers/events\");\nconst SessionHistory = require(\"../living/window/SessionHistory\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nconst defaultStyleSheet = require(\"./default-stylesheet\");\nlet parsedDefaultStyleSheet;\n\n// NB: the require() must be after assigning `module.exports` because this require() is circular\n// TODO: this above note might not even be true anymore... figure out the cycle and document it, or clean up.\nmodule.exports = Window;\nconst dom = require(\"../living\");\n\ndom.Window = Window;\n\n// NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\n\nfunction Window(options) {\n  EventTarget.setup(this);\n\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n\n  const window = this;\n\n  mixin(window, WindowEventHandlersImpl.prototype);\n  mixin(window, GlobalEventHandlersImpl.prototype);\n\n  this._initGlobalEvents();\n\n  ///// INTERFACES FROM THE DOM\n  // TODO: consider a mode of some sort where these are not shared between all DOM instances\n  // It'd be very memory-expensive in most cases, though.\n  for (const name in dom) {\n    Object.defineProperty(window, name, {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: dom[name]\n    });\n  }\n\n  ///// PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader;\n\n  // vm initialization is deferred until script processing is activated\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, { get: () => this._globalProxy });\n\n  let timers = Object.create(null);\n  let animationFrameCallbacks = Object.create(null);\n\n  // List options explicitly to be clear which are passed through\n  this._document = Document.create([], {\n    options: {\n      parsingMode: options.parsingMode,\n      contentType: options.contentType,\n      encoding: options.encoding,\n      cookieJar: options.cookieJar,\n      url: options.url,\n      lastModified: options.lastModified,\n      referrer: options.referrer,\n      concurrentNodeIterators: options.concurrentNodeIterators,\n      parseOptions: options.parseOptions,\n      defaultView: this._globalProxy,\n      global: this\n    }\n  });\n  // https://html.spec.whatwg.org/#session-history\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n\n  this._virtualConsole = options.virtualConsole;\n\n  this._runScripts = options.runScripts;\n  if (this._runScripts === \"outside-only\" || this._runScripts === \"dangerously\") {\n    contextifyWindow(this);\n  }\n\n  // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null;\n\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n  this._length = 0;\n\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota;\n\n  // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n  if (options.commonForOrigin && options.commonForOrigin[this._document.origin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [this._document.origin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[this._document.origin];\n\n  ///// WEB STORAGE\n\n  this._localStorage = Storage.create([], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create([], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n\n  ///// GETTERS\n\n  const locationbar = BarProp.create();\n  const menubar = BarProp.create();\n  const personalbar = BarProp.create();\n  const scrollbars = BarProp.create();\n  const statusbar = BarProp.create();\n  const toolbar = BarProp.create();\n  const external = External.create();\n  const navigator = Navigator.create([], { userAgent: this._resourceLoader._userAgent });\n  const performance = Performance.create([], { rawPerformance });\n  const screen = Screen.create();\n\n  define(this, {\n    get length() {\n      return window._length;\n    },\n    get window() {\n      return window._globalProxy;\n    },\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n    get frames() {\n      return window._globalProxy;\n    },\n    get self() {\n      return window._globalProxy;\n    },\n    get parent() {\n      return window._parent;\n    },\n    get top() {\n      return window._top;\n    },\n    get document() {\n      return window._document;\n    },\n    get external() {\n      return external;\n    },\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n    get navigator() {\n      return navigator;\n    },\n    get locationbar() {\n      return locationbar;\n    },\n    get menubar() {\n      return menubar;\n    },\n    get personalbar() {\n      return personalbar;\n    },\n    get scrollbars() {\n      return scrollbars;\n    },\n    get statusbar() {\n      return statusbar;\n    },\n    get toolbar() {\n      return toolbar;\n    },\n    get performance() {\n      return performance;\n    },\n    get screen() {\n      return screen;\n    },\n    get localStorage() {\n      if (this._document.origin === \"null\") {\n        throw new DOMException(\"localStorage is not available for opaque origins\", \"SecurityError\");\n      }\n\n      return this._localStorage;\n    },\n    get sessionStorage() {\n      if (this._document.origin === \"null\") {\n        throw new DOMException(\"sessionStorage is not available for opaque origins\", \"SecurityError\");\n      }\n\n      return this._sessionStorage;\n    }\n  });\n\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy);\n\n  ///// METHODS for [ImplicitThis] hack\n  // See https://lists.w3.org/Archives/Public/public-script-coord/2015JanMar/0109.html\n  this.addEventListener = this.addEventListener.bind(this);\n  this.removeEventListener = this.removeEventListener.bind(this);\n  this.dispatchEvent = this.dispatchEvent.bind(this);\n\n  ///// METHODS\n\n  let latestTimerId = 0;\n  let latestAnimationFrameCallbackId = 0;\n\n  this.setTimeout = function (fn, ms) {\n    const args = [];\n    for (let i = 2; i < arguments.length; ++i) {\n      args[i - 2] = arguments[i];\n    }\n    return startTimer(window, setTimeout, clearTimeout, ++latestTimerId, fn, ms, timers, args);\n  };\n  this.setInterval = function (fn, ms) {\n    const args = [];\n    for (let i = 2; i < arguments.length; ++i) {\n      args[i - 2] = arguments[i];\n    }\n    return startTimer(window, setInterval, clearInterval, ++latestTimerId, fn, ms, timers, args);\n  };\n  this.clearInterval = stopTimer.bind(this, timers);\n  this.clearTimeout = stopTimer.bind(this, timers);\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = fn => {\n      const timestamp = rawPerformance.now() - windowInitialized;\n      const fps = 1000 / 60;\n\n      return startTimer(\n        window,\n        setTimeout,\n        clearTimeout,\n        ++latestAnimationFrameCallbackId,\n        fn,\n        fps,\n        animationFrameCallbacks,\n        [timestamp]\n      );\n    };\n    this.cancelAnimationFrame = stopTimer.bind(this, animationFrameCallbacks);\n  }\n\n  this.__stopAllTimers = function () {\n    stopAllTimers(timers);\n    stopAllTimers(animationFrameCallbacks);\n\n    latestTimerId = 0;\n    latestAnimationFrameCallbackId = 0;\n\n    timers = Object.create(null);\n    animationFrameCallbacks = Object.create(null);\n  };\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n    impl._selectedness = selected;\n\n    return option;\n  }\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image() {\n    const img = window._document.createElement(\"img\");\n    const impl = idlUtils.implForWrapper(img);\n\n    if (arguments.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(arguments[0]));\n    }\n    if (arguments.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(arguments[1]));\n    }\n\n    return img;\n  }\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  this.postMessage = postMessage;\n\n  this.atob = function (str) {\n    const result = atob(str);\n    if (result === null) {\n      throw new DOMException(\"The string to be decoded contains invalid characters.\", \"InvalidCharacterError\");\n    }\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n    if (result === null) {\n      throw new DOMException(\"The string to be encoded contains invalid characters.\", \"InvalidCharacterError\");\n    }\n    return result;\n  };\n\n  this.FileReader = createFileReader({\n    window: this\n  }).interface;\n  this.WebSocket = createWebSocket({\n    window: this\n  }).interface;\n\n  const AbortSignalWrapper = createAbortSignal({\n    window: this\n  });\n  this.AbortSignal = AbortSignalWrapper.interface;\n  this.AbortController = createAbortController({\n    AbortSignal: AbortSignalWrapper\n  }).interface;\n\n  this.XMLHttpRequest = createXMLHttpRequest(this);\n\n  // TODO: necessary for Blob and FileReader due to different-globals weirdness; investigate how to avoid this.\n  this.ArrayBuffer = ArrayBuffer;\n  this.Int8Array = Int8Array;\n  this.Uint8Array = Uint8Array;\n  this.Uint8ClampedArray = Uint8ClampedArray;\n  this.Int16Array = Int16Array;\n  this.Uint16Array = Uint16Array;\n  this.Int32Array = Int32Array;\n  this.Uint32Array = Uint32Array;\n  this.Float32Array = Float32Array;\n  this.Float64Array = Float64Array;\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves.\n    const currentWindow = this;\n    (function windowCleaner(windowToClean) {\n      for (let i = 0; i < windowToClean.length; i++) {\n        windowCleaner(windowToClean[i]);\n      }\n\n      // We\"re already in our own window.close().\n      if (windowToClean !== currentWindow) {\n        windowToClean.close();\n      }\n    }(this));\n\n    // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n        this._document.close();\n      }\n      const doc = idlUtils.implForWrapper(this._document);\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n      delete this._document;\n    }\n\n    this.__stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt) {\n    elt = Element.convert(elt);\n\n    const declaration = new CSSStyleDeclaration();\n    const { forEach, indexOf } = Array.prototype;\n    const { style } = elt;\n\n    function setPropertiesFromRule(rule) {\n      if (!rule.selectorText) {\n        return;\n      }\n\n      const cssSelectorSplitRe = /((?:[^,\"']|\"[^\"]*\"|'[^']*')+)/;\n      const selectors = rule.selectorText.split(cssSelectorSplitRe);\n      let matched = false;\n\n      for (const selectorText of selectors) {\n        if (selectorText !== \"\" && selectorText !== \",\" && !matched && matchesDontThrow(elt, selectorText)) {\n          matched = true;\n          forEach.call(rule.style, property => {\n            declaration.setProperty(\n              property,\n              rule.style.getPropertyValue(property),\n              rule.style.getPropertyPriority(property)\n            );\n          });\n        }\n      }\n    }\n\n    function readStylesFromStyleSheet(sheet) {\n      forEach.call(sheet.cssRules, rule => {\n        if (rule.media) {\n          if (indexOf.call(rule.media, \"screen\") !== -1) {\n            forEach.call(rule.cssRules, setPropertiesFromRule);\n          }\n        } else {\n          setPropertiesFromRule(rule);\n        }\n      });\n    }\n\n    if (!parsedDefaultStyleSheet) {\n      parsedDefaultStyleSheet = cssom.parse(defaultStyleSheet);\n    }\n    readStylesFromStyleSheet(parsedDefaultStyleSheet);\n    forEach.call(elt.ownerDocument.styleSheets, readStylesFromStyleSheet);\n\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n\n    return declaration;\n  };\n\n  // The captureEvents() and releaseEvents() methods must do nothing\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {};\n\n  ///// PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  });\n\n  ///// INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, window.document);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, window.document);\n\n        if (!idlUtils.implForWrapper(window._document)._pageShowingFlag) {\n          idlUtils.implForWrapper(window._document)._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, { persisted: false }, window.document);\n        }\n      });\n    }\n  });\n}\n\nObject.setPrototypeOf(Window, EventTarget.interface);\nObject.setPrototypeOf(Window.prototype, EventTarget.interface.prototype);\nObject.defineProperty(Window.prototype, Symbol.toStringTag, {\n  value: \"Window\",\n  writable: false,\n  enumerable: false,\n  configurable: true\n});\n\nfunction startTimer(window, startFn, stopFn, timerId, callback, ms, timerStorage, args) {\n  if (!window || !window._document) {\n    return undefined;\n  }\n  if (typeof callback !== \"function\") {\n    const code = String(callback);\n    callback = window._globalProxy.eval.bind(window, code + `\\n//# sourceURL=${window.location.href}`);\n  }\n\n  const oldCallback = callback;\n  callback = () => {\n    try {\n      oldCallback.apply(window._globalProxy, args);\n    } catch (e) {\n      reportException(window, e, window.location.href);\n    }\n  };\n\n  const res = startFn(callback, ms);\n  timerStorage[timerId] = [res, stopFn];\n  return timerId;\n}\n\nfunction stopTimer(timerStorage, id) {\n  const timer = timerStorage[id];\n  if (timer) {\n    // Need to .call() with undefined to ensure the thisArg is not timer itself\n    timer[1].call(undefined, timer[0]);\n    delete timerStorage[id];\n  }\n}\n\nfunction stopAllTimers(timers) {\n  Object.keys(timers).forEach(key => {\n    const timer = timers[key];\n    // Need to .call() with undefined to ensure the thisArg is not timer itself\n    timer[1].call(undefined, timer[0]);\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n  const documentImpl = idlUtils.implForWrapper(window._document);\n  documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n}\n"]},"metadata":{},"sourceType":"script"}