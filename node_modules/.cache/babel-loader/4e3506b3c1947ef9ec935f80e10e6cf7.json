{"ast":null,"code":"\"use strict\";\n\nconst {\n  CookieJar\n} = require(\"tough-cookie\");\n\nconst NodeImpl = require(\"./Node-impl\").implementation;\n\nconst idlUtils = require(\"../generated/utils\");\n\nconst NODE_TYPE = require(\"../node-type\");\n\nconst {\n  mixin,\n  memoizeQuery\n} = require(\"../../utils\");\n\nconst {\n  firstChildWithLocalName,\n  firstChildWithLocalNames,\n  firstDescendantWithLocalName\n} = require(\"../helpers/traversal\");\n\nconst whatwgURL = require(\"whatwg-url\");\n\nconst {\n  StyleSheetList\n} = require(\"../../level2/style\");\n\nconst {\n  domSymbolTree\n} = require(\"../helpers/internal-constants\");\n\nconst eventAccessors = require(\"../helpers/create-event-accessor\");\n\nconst {\n  asciiLowercase,\n  stripAndCollapseASCIIWhitespace\n} = require(\"../helpers/strings\");\n\nconst {\n  childTextContent\n} = require(\"../helpers/text\");\n\nconst {\n  HTML_NS,\n  SVG_NS\n} = require(\"../helpers/namespaces\");\n\nconst DOMException = require(\"domexception\");\n\nconst {\n  parseIntoDocument\n} = require(\"../../browser/parser\");\n\nconst History = require(\"../generated/History\");\n\nconst Location = require(\"../generated/Location\");\n\nconst HTMLCollection = require(\"../generated/HTMLCollection\");\n\nconst NodeList = require(\"../generated/NodeList\");\n\nconst validateName = require(\"../helpers/validate-names\").name;\n\nconst {\n  validateAndExtract\n} = require(\"../helpers/validate-names\");\n\nconst {\n  fireAnEvent\n} = require(\"../helpers/events\");\n\nconst {\n  shadowIncludingInclusiveDescendantsIterator\n} = require(\"../helpers/shadow-dom\");\n\nconst GlobalEventHandlersImpl = require(\"./GlobalEventHandlers-impl\").implementation;\n\nconst {\n  clone,\n  listOfElementsWithQualifiedName,\n  listOfElementsWithNamespaceAndLocalName,\n  listOfElementsWithClassNames\n} = require(\"../node\");\n\nconst generatedAttr = require(\"../generated/Attr\");\n\nconst Comment = require(\"../generated/Comment\");\n\nconst ProcessingInstruction = require(\"../generated/ProcessingInstruction\");\n\nconst CDATASection = require(\"../generated/CDATASection\");\n\nconst Text = require(\"../generated/Text\");\n\nconst DocumentFragment = require(\"../generated/DocumentFragment\");\n\nconst DOMImplementation = require(\"../generated/DOMImplementation\");\n\nconst NonElementParentNodeImpl = require(\"./NonElementParentNode-impl\").implementation;\n\nconst ParentNodeImpl = require(\"./ParentNode-impl\").implementation;\n\nconst Element = require(\"../generated/Element\");\n\nconst HTMLUnknownElement = require(\"../generated/HTMLUnknownElement\");\n\nconst SVGElement = require(\"../generated/SVGElement\");\n\nconst TreeWalker = require(\"../generated/TreeWalker\");\n\nconst NodeIterator = require(\"../generated/NodeIterator\");\n\nconst ShadowRoot = require(\"../generated/ShadowRoot\");\n\nconst CustomEvent = require(\"../generated/CustomEvent\");\n\nconst ErrorEvent = require(\"../generated/ErrorEvent\");\n\nconst Event = require(\"../generated/Event\");\n\nconst FocusEvent = require(\"../generated/FocusEvent\");\n\nconst HashChangeEvent = require(\"../generated/HashChangeEvent\");\n\nconst KeyboardEvent = require(\"../generated/KeyboardEvent\");\n\nconst MessageEvent = require(\"../generated/MessageEvent\");\n\nconst MouseEvent = require(\"../generated/MouseEvent\");\n\nconst PopStateEvent = require(\"../generated/PopStateEvent\");\n\nconst ProgressEvent = require(\"../generated/ProgressEvent\");\n\nconst TouchEvent = require(\"../generated/TouchEvent\");\n\nconst UIEvent = require(\"../generated/UIEvent\");\n\nconst RequestManager = require(\"../../browser/resources/request-manager\");\n\nconst AsyncResourceQueue = require(\"../../browser/resources/async-resource-queue\");\n\nconst ResourceQueue = require(\"../../browser/resources/resource-queue\");\n\nconst PerDocumentResourceLoader = require(\"../../browser/resources/per-document-resource-loader\");\n\nfunction clearChildNodes(node) {\n  for (let child = domSymbolTree.firstChild(node); child; child = domSymbolTree.firstChild(node)) {\n    node.removeChild(child);\n  }\n}\n\nfunction pad(number) {\n  if (number < 10) {\n    return \"0\" + number;\n  }\n\n  return number;\n}\n\nfunction toLastModifiedString(date) {\n  return pad(date.getMonth() + 1) + \"/\" + pad(date.getDate()) + \"/\" + date.getFullYear() + \" \" + pad(date.getHours()) + \":\" + pad(date.getMinutes()) + \":\" + pad(date.getSeconds());\n}\n\nconst eventInterfaceTable = {\n  customevent: CustomEvent,\n  errorevent: ErrorEvent,\n  event: Event,\n  events: Event,\n  focusevent: FocusEvent,\n  hashchangeevent: HashChangeEvent,\n  htmlevents: Event,\n  keyboardevent: KeyboardEvent,\n  messageevent: MessageEvent,\n  mouseevent: MouseEvent,\n  mouseevents: MouseEvent,\n  popstateevent: PopStateEvent,\n  progressevent: ProgressEvent,\n  svgevents: Event,\n  touchevent: TouchEvent,\n  uievent: UIEvent,\n  uievents: UIEvent\n};\n\nclass DocumentImpl extends NodeImpl {\n  constructor(args, privateData) {\n    super(args, privateData);\n\n    this._initGlobalEvents();\n\n    this._ownerDocument = this;\n    this.nodeType = NODE_TYPE.DOCUMENT_NODE;\n\n    if (!privateData.options) {\n      privateData.options = {};\n    }\n\n    if (!privateData.options.parsingMode) {\n      privateData.options.parsingMode = \"xml\";\n    }\n\n    if (!privateData.options.encoding) {\n      privateData.options.encoding = \"UTF-8\";\n    }\n\n    if (!privateData.options.contentType) {\n      privateData.options.contentType = privateData.options.parsingMode === \"xml\" ? \"application/xml\" : \"text/html\";\n    }\n\n    this._parsingMode = privateData.options.parsingMode;\n    this._implementation = DOMImplementation.createImpl([], {\n      ownerDocument: this\n    });\n    this._defaultView = privateData.options.defaultView || null;\n    this._global = privateData.options.global;\n    this._documentElement = null;\n    this._ids = Object.create(null);\n    this._attached = true;\n    this._currentScript = null;\n    this._pageShowingFlag = false;\n    this._cookieJar = privateData.options.cookieJar;\n    this._parseOptions = privateData.options.parseOptions;\n    this._scriptingDisabled = privateData.options.scriptingDisabled;\n\n    if (this._cookieJar === undefined) {\n      this._cookieJar = new CookieJar(null, {\n        looseMode: true\n      });\n    }\n\n    this.contentType = privateData.options.contentType;\n    this._encoding = privateData.options.encoding;\n    const urlOption = privateData.options.url === undefined ? \"about:blank\" : privateData.options.url;\n    const parsed = whatwgURL.parseURL(urlOption);\n\n    if (parsed === null) {\n      throw new TypeError(`Could not parse \"${urlOption}\" as a URL`);\n    }\n\n    this._URL = parsed;\n    this.origin = whatwgURL.serializeURLOrigin(parsed);\n    this._location = Location.createImpl([], {\n      relevantDocument: this\n    });\n    this._history = History.createImpl([], {\n      window: this._defaultView,\n      document: this,\n      actAsIfLocationReloadCalled: () => this._location.reload()\n    });\n    this._workingNodeIterators = [];\n    this._workingNodeIteratorsMax = privateData.options.concurrentNodeIterators === undefined ? 10 : Number(privateData.options.concurrentNodeIterators);\n\n    if (isNaN(this._workingNodeIteratorsMax)) {\n      throw new TypeError(\"The 'concurrentNodeIterators' option must be a Number\");\n    }\n\n    if (this._workingNodeIteratorsMax < 0) {\n      throw new RangeError(\"The 'concurrentNodeIterators' option must be a non negative Number\");\n    }\n\n    this._referrer = privateData.options.referrer || \"\";\n    this._lastModified = toLastModifiedString(privateData.options.lastModified || new Date());\n    this._asyncQueue = new AsyncResourceQueue();\n    this._queue = new ResourceQueue({\n      asyncQueue: this._asyncQueue,\n      paused: false\n    });\n    this._deferQueue = new ResourceQueue({\n      paused: true\n    });\n    this._requestManager = new RequestManager();\n    this.readyState = privateData.options.readyState || \"loading\";\n    this._lastFocusedElement = null;\n    this._resourceLoader = new PerDocumentResourceLoader(this); // Each Document in a browsing context can also have a latest entry. This is the entry for that Document\n    // to which the browsing context's session history was most recently traversed. When a Document is created,\n    // it initially has no latest entry.\n\n    this._latestEntry = null;\n  }\n\n  _getTheParent(event) {\n    if (event.type === \"load\" || !this._defaultView) {\n      return null;\n    }\n\n    return idlUtils.implForWrapper(this._defaultView);\n  }\n\n  get compatMode() {\n    return this._parsingMode === \"xml\" || this.doctype ? \"CSS1Compat\" : \"BackCompat\";\n  }\n\n  get charset() {\n    return this._encoding;\n  }\n\n  get characterSet() {\n    return this._encoding;\n  }\n\n  get inputEncoding() {\n    return this._encoding;\n  }\n\n  get doctype() {\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n        return childNode;\n      }\n    }\n\n    return null;\n  }\n\n  get URL() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n\n  get documentURI() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n\n  get location() {\n    return this._defaultView ? this._location : null;\n  }\n\n  get documentElement() {\n    if (this._documentElement) {\n      return this._documentElement;\n    }\n\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        this._documentElement = childNode;\n        return childNode;\n      }\n    }\n\n    return null;\n  }\n\n  get implementation() {\n    return this._implementation;\n  }\n\n  set implementation(implementation) {\n    this._implementation = implementation;\n  }\n\n  get defaultView() {\n    return this._defaultView;\n  }\n\n  get currentScript() {\n    return this._currentScript;\n  }\n\n  get activeElement() {\n    if (this._lastFocusedElement) {\n      return this._lastFocusedElement;\n    }\n\n    return this.body;\n  }\n\n  hasFocus() {\n    return Boolean(this._lastFocusedElement);\n  }\n\n  _createElementWithCorrectElementInterface(localName, namespace) {\n    // https://dom.spec.whatwg.org/#concept-element-interface\n    if (this._elementBuilders[namespace] && this._elementBuilders[namespace][localName]) {\n      return this._elementBuilders[namespace][localName](this, localName, namespace);\n    } else if (namespace === HTML_NS) {\n      return HTMLUnknownElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    } else if (namespace === SVG_NS) {\n      return SVGElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    }\n\n    return Element.createImpl([], {\n      ownerDocument: this,\n      localName,\n      namespace\n    });\n  }\n\n  appendChild(\n  /* Node */\n  arg) {\n    if (this.documentElement && arg.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      throw new DOMException(\"The operation would yield an incorrect node tree.\", \"HierarchyRequestError\");\n    }\n\n    return super.appendChild(arg);\n  }\n\n  removeChild(\n  /* Node */\n  arg) {\n    const ret = super.removeChild(arg);\n\n    if (arg === this._documentElement) {\n      this._documentElement = null; // force a recalculation\n    }\n\n    return ret;\n  }\n\n  _descendantRemoved(parent, child) {\n    if (child.tagName === \"STYLE\") {\n      const index = this.styleSheets.indexOf(child.sheet);\n\n      if (index > -1) {\n        this.styleSheets.splice(index, 1);\n      }\n    }\n\n    super._descendantRemoved.apply(this, arguments);\n  }\n\n  write() {\n    let text = \"\";\n\n    for (let i = 0; i < arguments.length; ++i) {\n      text += String(arguments[i]);\n    }\n\n    if (this._parsingMode === \"xml\") {\n      throw new DOMException(\"Cannot use document.write on XML documents\", \"InvalidStateError\");\n    }\n\n    if (this._writeAfterElement) {\n      // If called from an script element directly (during the first tick),\n      // the new elements are inserted right after that element.\n      const tempDiv = this.createElement(\"div\");\n      tempDiv.innerHTML = text;\n      let child = tempDiv.firstChild;\n      let previous = this._writeAfterElement;\n      const parent = this._writeAfterElement.parentNode;\n\n      while (child) {\n        const node = child;\n        child = child.nextSibling;\n        node._isMovingDueToDocumentWrite = true; // hack for script execution\n\n        parent.insertBefore(node, previous.nextSibling);\n        node._isMovingDueToDocumentWrite = false;\n        previous = node;\n      }\n    } else if (this.readyState === \"loading\") {\n      // During page loading, document.write appends to the current element\n      // Find the last child that has been added to the document.\n      if (this.lastChild) {\n        let node = this;\n\n        while (node.lastChild && node.lastChild.nodeType === NODE_TYPE.ELEMENT_NODE) {\n          node = node.lastChild;\n        }\n\n        node.innerHTML = text;\n      } else {\n        clearChildNodes(this);\n        parseIntoDocument(text, this);\n      }\n    } else if (text) {\n      clearChildNodes(this);\n      parseIntoDocument(text, this);\n    }\n  }\n\n  writeln() {\n    this.write(...arguments, \"\\n\");\n  } // This is implemented separately for Document (which has a _ids cache) and DocumentFragment (which does not).\n\n\n  getElementById(id) {\n    if (!this._ids[id]) {\n      return null;\n    } // Let's find the first element with where it's root is the document.\n\n\n    const matchElement = this._ids[id].find(candidate => {\n      let root = candidate;\n\n      while (domSymbolTree.parent(root)) {\n        root = domSymbolTree.parent(root);\n      }\n\n      return root === this;\n    });\n\n    return matchElement || null;\n  }\n\n  get referrer() {\n    return this._referrer || \"\";\n  }\n\n  get lastModified() {\n    return this._lastModified;\n  }\n\n  get images() {\n    return this.getElementsByTagName(\"IMG\");\n  }\n\n  get embeds() {\n    return this.getElementsByTagName(\"EMBED\");\n  }\n\n  get plugins() {\n    return this.embeds;\n  }\n\n  get links() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => (node._localName === \"a\" || node._localName === \"area\") && node.hasAttributeNS(null, \"href\") && node._namespaceURI === HTML_NS\n      })\n    });\n  }\n\n  get forms() {\n    return this.getElementsByTagName(\"FORM\");\n  }\n\n  get scripts() {\n    return this.getElementsByTagName(\"SCRIPT\");\n  }\n\n  get anchors() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node._localName === \"a\" && node.hasAttributeNS(null, \"name\") && node._namespaceURI === HTML_NS\n      })\n    });\n  } // The applets attribute must return an\n  // HTMLCollection rooted at the Document node,\n  // whose filter matches nothing.\n  // (It exists for historical reasons.)\n\n\n  get applets() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => []\n    });\n  }\n\n  open() {\n    let child = domSymbolTree.firstChild(this);\n\n    while (child) {\n      this.removeChild(child);\n      child = domSymbolTree.firstChild(this);\n    }\n\n    this._documentElement = null;\n\n    this._modified();\n\n    return this;\n  }\n\n  close(noQueue) {\n    // In some cases like when creating an empty iframe, I want to emit the\n    // events right away to avoid problems if later I asign the property src.\n    if (noQueue) {\n      this.readyState = \"complete\";\n      fireAnEvent(\"DOMContentLoaded\", this, undefined, {\n        bubbles: true\n      });\n      fireAnEvent(\"load\", this);\n      return;\n    }\n\n    this._queue.resume();\n\n    const dummyPromise = Promise.resolve();\n\n    const onDOMContentLoad = () => {\n      const doc = this;\n\n      function dispatchEvent() {\n        // https://html.spec.whatwg.org/#the-end\n        doc.readyState = \"interactive\";\n        fireAnEvent(\"DOMContentLoaded\", doc, undefined, {\n          bubbles: true\n        });\n      }\n\n      return new Promise(resolve => {\n        if (!this._deferQueue.tail) {\n          dispatchEvent();\n          return resolve();\n        }\n\n        this._deferQueue.setListener(() => {\n          dispatchEvent();\n          resolve();\n        });\n\n        return this._deferQueue.resume();\n      });\n    };\n\n    const onLoad = () => {\n      const doc = this;\n\n      function dispatchEvent() {\n        doc.readyState = \"complete\";\n        fireAnEvent(\"load\", doc);\n      }\n\n      return new Promise(resolve => {\n        if (this._asyncQueue.count() === 0) {\n          dispatchEvent();\n          return resolve();\n        }\n\n        return this._asyncQueue.setListener(() => {\n          dispatchEvent();\n          resolve();\n        });\n      });\n    };\n\n    this._queue.push(dummyPromise, onDOMContentLoad, null); // Set the readyState to 'complete' once all resources are loaded.\n    // As a side-effect the document's load-event will be dispatched.\n\n\n    this._queue.push(dummyPromise, onLoad, null, true);\n  }\n\n  getElementsByName(elementName) {\n    return NodeList.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node.getAttributeNS && node.getAttributeNS(null, \"name\") === elementName\n      })\n    });\n  }\n\n  get title() {\n    const {\n      documentElement\n    } = this;\n    let value = \"\";\n\n    if (documentElement && documentElement._localName === \"svg\") {\n      const svgTitleElement = firstChildWithLocalName(documentElement, \"title\", SVG_NS);\n\n      if (svgTitleElement) {\n        value = childTextContent(svgTitleElement);\n      }\n    } else {\n      const titleElement = firstDescendantWithLocalName(this, \"title\");\n\n      if (titleElement) {\n        value = childTextContent(titleElement);\n      }\n    }\n\n    value = stripAndCollapseASCIIWhitespace(value);\n    return value;\n  }\n\n  set title(value) {\n    const {\n      documentElement\n    } = this;\n    let element;\n\n    if (documentElement && documentElement._localName === \"svg\") {\n      element = firstChildWithLocalName(documentElement, \"title\", SVG_NS);\n\n      if (!element) {\n        element = this.createElementNS(SVG_NS, \"title\");\n\n        this._insert(element, documentElement.firstChild);\n      }\n\n      element.textContent = value;\n    } else if (documentElement && documentElement._namespaceURI === HTML_NS) {\n      const titleElement = firstDescendantWithLocalName(this, \"title\");\n      const headElement = this.head;\n\n      if (titleElement === null && headElement === null) {\n        return;\n      }\n\n      if (titleElement !== null) {\n        element = titleElement;\n      } else {\n        element = this.createElement(\"title\");\n\n        headElement._append(element);\n      }\n\n      element.textContent = value;\n    }\n  }\n\n  get dir() {\n    return this.documentElement ? this.documentElement.dir : \"\";\n  }\n\n  set dir(value) {\n    if (this.documentElement) {\n      this.documentElement.dir = value;\n    }\n  }\n\n  get head() {\n    return this.documentElement ? firstChildWithLocalName(this.documentElement, \"head\") : null;\n  }\n\n  get body() {\n    const {\n      documentElement\n    } = this;\n\n    if (!documentElement || documentElement._localName !== \"html\" || documentElement._namespaceURI !== HTML_NS) {\n      return null;\n    }\n\n    return firstChildWithLocalNames(this.documentElement, new Set([\"body\", \"frameset\"]));\n  }\n\n  set body(value) {\n    if (value === null || value._namespaceURI !== HTML_NS || value._localName !== \"body\" && value._localName !== \"frameset\") {\n      throw new DOMException(\"Cannot set the body to null or a non-body/frameset element\", \"HierarchyRequestError\");\n    }\n\n    const bodyElement = this.body;\n\n    if (value === bodyElement) {\n      return;\n    }\n\n    if (bodyElement !== null) {\n      bodyElement.parentNode._replace(value, bodyElement);\n\n      return;\n    }\n\n    const {\n      documentElement\n    } = this;\n\n    if (documentElement === null) {\n      throw new DOMException(\"Cannot set the body when there is no document element\", \"HierarchyRequestError\");\n    }\n\n    documentElement._append(value);\n  }\n\n  _runPreRemovingSteps(oldNode) {\n    for (const activeNodeIterator of this._workingNodeIterators) {\n      activeNodeIterator._preRemovingSteps(oldNode);\n    }\n  }\n\n  createEvent(type) {\n    const typeLower = type.toLowerCase();\n    const eventWrapper = eventInterfaceTable[typeLower] || null;\n\n    if (!eventWrapper) {\n      throw new DOMException(\"The provided event type (\\\"\" + type + \"\\\") is invalid\", \"NotSupportedError\");\n    }\n\n    const impl = eventWrapper.createImpl([\"\"]);\n    impl._initializedFlag = false;\n    return impl;\n  }\n\n  createProcessingInstruction(target, data) {\n    validateName(target);\n\n    if (data.includes(\"?>\")) {\n      throw new DOMException(\"Processing instruction data cannot contain the string \\\"?>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return ProcessingInstruction.createImpl([], {\n      ownerDocument: this,\n      target,\n      data\n    });\n  } // https://dom.spec.whatwg.org/#dom-document-createcdatasection\n\n\n  createCDATASection(data) {\n    if (this._parsingMode === \"html\") {\n      throw new DOMException(\"Cannot create CDATA sections in HTML documents\", \"NotSupportedError\");\n    }\n\n    if (data.includes(\"]]>\")) {\n      throw new DOMException(\"CDATA section data cannot contain the string \\\"]]>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return CDATASection.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createTextNode(data) {\n    return Text.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createComment(data) {\n    return Comment.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createElement(localName) {\n    validateName(localName);\n\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    const namespace = this._parsingMode === \"html\" || this.contentType === \"application/xhtml+xml\" ? HTML_NS : null;\n    return this._createElementWithCorrectElementInterface(localName, namespace);\n  }\n\n  createElementNS(namespace, qualifiedName) {\n    namespace = namespace !== null ? String(namespace) : namespace;\n    const extracted = validateAndExtract(namespace, qualifiedName);\n\n    const element = this._createElementWithCorrectElementInterface(extracted.localName, extracted.namespace);\n\n    element._prefix = extracted.prefix;\n    return element;\n  }\n\n  createDocumentFragment() {\n    return DocumentFragment.createImpl([], {\n      ownerDocument: this\n    });\n  }\n\n  createAttribute(localName) {\n    validateName(localName);\n\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    return generatedAttr.createImpl([], {\n      localName\n    });\n  }\n\n  createAttributeNS(namespace, name) {\n    if (namespace === undefined) {\n      namespace = null;\n    }\n\n    namespace = namespace !== null ? String(namespace) : namespace;\n    const extracted = validateAndExtract(namespace, name);\n    return generatedAttr.createImpl([], {\n      namespace: extracted.namespace,\n      namespacePrefix: extracted.prefix,\n      localName: extracted.localName\n    });\n  } // TODO: Add callback interface support to `webidl2js`\n\n\n  createTreeWalker(root, whatToShow, filter) {\n    return TreeWalker.createImpl([], {\n      root,\n      whatToShow,\n      filter\n    });\n  }\n\n  createNodeIterator(root, whatToShow, filter) {\n    const nodeIterator = NodeIterator.createImpl([], {\n      root,\n      whatToShow,\n      filter\n    });\n\n    this._workingNodeIterators.push(nodeIterator);\n\n    while (this._workingNodeIterators.length > this._workingNodeIteratorsMax) {\n      const toInactivate = this._workingNodeIterators.shift();\n\n      toInactivate._working = false;\n    }\n\n    return nodeIterator;\n  }\n\n  importNode(node, deep) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot import a document node\", \"NotSupportedError\");\n    } else if (ShadowRoot.isImpl(node)) {\n      throw new DOMException(\"Cannot adopt a shadow root\", \"NotSupportedError\");\n    }\n\n    return clone(node, this, deep);\n  } // https://dom.spec.whatwg.org/#dom-document-adoptnode\n\n\n  adoptNode(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot adopt a document node\", \"NotSupportedError\");\n    } else if (ShadowRoot.isImpl(node)) {\n      throw new DOMException(\"Cannot adopt a shadow root\", \"HierarchyRequestError\");\n    }\n\n    this._adoptNode(node);\n\n    return node;\n  } // https://dom.spec.whatwg.org/#concept-node-adopt\n\n\n  _adoptNode(node) {\n    const newDocument = this;\n    const oldDocument = node._ownerDocument;\n    const parent = domSymbolTree.parent(node);\n\n    if (parent) {\n      parent._remove(node);\n    }\n\n    if (oldDocument !== newDocument) {\n      for (const inclusiveDescendant of shadowIncludingInclusiveDescendantsIterator(node)) {\n        inclusiveDescendant._ownerDocument = newDocument;\n      }\n\n      for (const inclusiveDescendant of shadowIncludingInclusiveDescendantsIterator(node)) {\n        if (inclusiveDescendant._adoptingSteps) {\n          inclusiveDescendant._adoptingSteps(oldDocument);\n        }\n      }\n    }\n  }\n\n  get cookie() {\n    return this._cookieJar.getCookieStringSync(this.URL, {\n      http: false\n    });\n  }\n\n  set cookie(cookieStr) {\n    cookieStr = String(cookieStr);\n\n    this._cookieJar.setCookieSync(cookieStr, this.URL, {\n      http: false,\n      ignoreError: true\n    });\n  } // The clear(), captureEvents(), and releaseEvents() methods must do nothing\n\n\n  clear() {}\n\n  captureEvents() {}\n\n  releaseEvents() {}\n\n  get styleSheets() {\n    if (!this._styleSheets) {\n      this._styleSheets = new StyleSheetList();\n    } // TODO: each style and link element should register its sheet on creation\n    // and remove it on removal.\n\n\n    return this._styleSheets;\n  }\n\n  get hidden() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return false;\n    }\n\n    return true;\n  }\n\n  get visibilityState() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return \"visible\";\n    }\n\n    return \"prerender\";\n  }\n\n}\n\neventAccessors.createEventAccessor(DocumentImpl.prototype, \"readystatechange\");\nmixin(DocumentImpl.prototype, GlobalEventHandlersImpl.prototype);\nmixin(DocumentImpl.prototype, NonElementParentNodeImpl.prototype);\nmixin(DocumentImpl.prototype, ParentNodeImpl.prototype);\nDocumentImpl.prototype._elementBuilders = Object.create(null);\nDocumentImpl.prototype.getElementsByTagName = memoizeQuery(function (qualifiedName) {\n  return listOfElementsWithQualifiedName(qualifiedName, this);\n});\nDocumentImpl.prototype.getElementsByTagNameNS = memoizeQuery(function (namespace, localName) {\n  return listOfElementsWithNamespaceAndLocalName(namespace, localName, this);\n});\nDocumentImpl.prototype.getElementsByClassName = memoizeQuery(function getElementsByClassName(classNames) {\n  return listOfElementsWithClassNames(classNames, this);\n});\nmodule.exports = {\n  implementation: DocumentImpl\n};","map":{"version":3,"sources":["/Users/liamfink/class-app/node_modules/jsdom/lib/jsdom/living/nodes/Document-impl.js"],"names":["CookieJar","require","NodeImpl","implementation","idlUtils","NODE_TYPE","mixin","memoizeQuery","firstChildWithLocalName","firstChildWithLocalNames","firstDescendantWithLocalName","whatwgURL","StyleSheetList","domSymbolTree","eventAccessors","asciiLowercase","stripAndCollapseASCIIWhitespace","childTextContent","HTML_NS","SVG_NS","DOMException","parseIntoDocument","History","Location","HTMLCollection","NodeList","validateName","name","validateAndExtract","fireAnEvent","shadowIncludingInclusiveDescendantsIterator","GlobalEventHandlersImpl","clone","listOfElementsWithQualifiedName","listOfElementsWithNamespaceAndLocalName","listOfElementsWithClassNames","generatedAttr","Comment","ProcessingInstruction","CDATASection","Text","DocumentFragment","DOMImplementation","NonElementParentNodeImpl","ParentNodeImpl","Element","HTMLUnknownElement","SVGElement","TreeWalker","NodeIterator","ShadowRoot","CustomEvent","ErrorEvent","Event","FocusEvent","HashChangeEvent","KeyboardEvent","MessageEvent","MouseEvent","PopStateEvent","ProgressEvent","TouchEvent","UIEvent","RequestManager","AsyncResourceQueue","ResourceQueue","PerDocumentResourceLoader","clearChildNodes","node","child","firstChild","removeChild","pad","number","toLastModifiedString","date","getMonth","getDate","getFullYear","getHours","getMinutes","getSeconds","eventInterfaceTable","customevent","errorevent","event","events","focusevent","hashchangeevent","htmlevents","keyboardevent","messageevent","mouseevent","mouseevents","popstateevent","progressevent","svgevents","touchevent","uievent","uievents","DocumentImpl","constructor","args","privateData","_initGlobalEvents","_ownerDocument","nodeType","DOCUMENT_NODE","options","parsingMode","encoding","contentType","_parsingMode","_implementation","createImpl","ownerDocument","_defaultView","defaultView","_global","global","_documentElement","_ids","Object","create","_attached","_currentScript","_pageShowingFlag","_cookieJar","cookieJar","_parseOptions","parseOptions","_scriptingDisabled","scriptingDisabled","undefined","looseMode","_encoding","urlOption","url","parsed","parseURL","TypeError","_URL","origin","serializeURLOrigin","_location","relevantDocument","_history","window","document","actAsIfLocationReloadCalled","reload","_workingNodeIterators","_workingNodeIteratorsMax","concurrentNodeIterators","Number","isNaN","RangeError","_referrer","referrer","_lastModified","lastModified","Date","_asyncQueue","_queue","asyncQueue","paused","_deferQueue","_requestManager","readyState","_lastFocusedElement","_resourceLoader","_latestEntry","_getTheParent","type","implForWrapper","compatMode","doctype","charset","characterSet","inputEncoding","childNode","childrenIterator","DOCUMENT_TYPE_NODE","URL","serializeURL","documentURI","location","documentElement","ELEMENT_NODE","currentScript","activeElement","body","hasFocus","Boolean","_createElementWithCorrectElementInterface","localName","namespace","_elementBuilders","appendChild","arg","ret","_descendantRemoved","parent","tagName","index","styleSheets","indexOf","sheet","splice","apply","arguments","write","text","i","length","String","_writeAfterElement","tempDiv","createElement","innerHTML","previous","parentNode","nextSibling","_isMovingDueToDocumentWrite","insertBefore","lastChild","writeln","getElementById","id","matchElement","find","candidate","root","images","getElementsByTagName","embeds","plugins","links","element","query","treeToArray","filter","_localName","hasAttributeNS","_namespaceURI","forms","scripts","anchors","applets","open","_modified","close","noQueue","bubbles","resume","dummyPromise","Promise","resolve","onDOMContentLoad","doc","dispatchEvent","tail","setListener","onLoad","count","push","getElementsByName","elementName","getAttributeNS","title","value","svgTitleElement","titleElement","createElementNS","_insert","textContent","headElement","head","_append","dir","Set","bodyElement","_replace","_runPreRemovingSteps","oldNode","activeNodeIterator","_preRemovingSteps","createEvent","typeLower","toLowerCase","eventWrapper","impl","_initializedFlag","createProcessingInstruction","target","data","includes","createCDATASection","createTextNode","createComment","qualifiedName","extracted","_prefix","prefix","createDocumentFragment","createAttribute","createAttributeNS","namespacePrefix","createTreeWalker","whatToShow","createNodeIterator","nodeIterator","toInactivate","shift","_working","importNode","deep","isImpl","adoptNode","_adoptNode","newDocument","oldDocument","_remove","inclusiveDescendant","_adoptingSteps","cookie","getCookieStringSync","http","cookieStr","setCookieSync","ignoreError","clear","captureEvents","releaseEvents","_styleSheets","hidden","_pretendToBeVisual","visibilityState","createEventAccessor","prototype","getElementsByTagNameNS","getElementsByClassName","classNames","module","exports"],"mappings":"AAAA;;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAAgBC,OAAO,CAAC,cAAD,CAA7B;;AAEA,MAAMC,QAAQ,GAAGD,OAAO,CAAC,aAAD,CAAP,CAAuBE,cAAxC;;AACA,MAAMC,QAAQ,GAAGH,OAAO,CAAC,oBAAD,CAAxB;;AACA,MAAMI,SAAS,GAAGJ,OAAO,CAAC,cAAD,CAAzB;;AACA,MAAM;AAAEK,EAAAA,KAAF;AAASC,EAAAA;AAAT,IAA0BN,OAAO,CAAC,aAAD,CAAvC;;AACA,MAAM;AAAEO,EAAAA,uBAAF;AAA2BC,EAAAA,wBAA3B;AAAqDC,EAAAA;AAArD,IACJT,OAAO,CAAC,sBAAD,CADT;;AAEA,MAAMU,SAAS,GAAGV,OAAO,CAAC,YAAD,CAAzB;;AACA,MAAM;AAAEW,EAAAA;AAAF,IAAqBX,OAAO,CAAC,oBAAD,CAAlC;;AACA,MAAM;AAAEY,EAAAA;AAAF,IAAoBZ,OAAO,CAAC,+BAAD,CAAjC;;AACA,MAAMa,cAAc,GAAGb,OAAO,CAAC,kCAAD,CAA9B;;AACA,MAAM;AAAEc,EAAAA,cAAF;AAAkBC,EAAAA;AAAlB,IAAsDf,OAAO,CAAC,oBAAD,CAAnE;;AACA,MAAM;AAAEgB,EAAAA;AAAF,IAAuBhB,OAAO,CAAC,iBAAD,CAApC;;AACA,MAAM;AAAEiB,EAAAA,OAAF;AAAWC,EAAAA;AAAX,IAAsBlB,OAAO,CAAC,uBAAD,CAAnC;;AACA,MAAMmB,YAAY,GAAGnB,OAAO,CAAC,cAAD,CAA5B;;AACA,MAAM;AAAEoB,EAAAA;AAAF,IAAwBpB,OAAO,CAAC,sBAAD,CAArC;;AACA,MAAMqB,OAAO,GAAGrB,OAAO,CAAC,sBAAD,CAAvB;;AACA,MAAMsB,QAAQ,GAAGtB,OAAO,CAAC,uBAAD,CAAxB;;AACA,MAAMuB,cAAc,GAAGvB,OAAO,CAAC,6BAAD,CAA9B;;AACA,MAAMwB,QAAQ,GAAGxB,OAAO,CAAC,uBAAD,CAAxB;;AACA,MAAMyB,YAAY,GAAGzB,OAAO,CAAC,2BAAD,CAAP,CAAqC0B,IAA1D;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAyB3B,OAAO,CAAC,2BAAD,CAAtC;;AACA,MAAM;AAAE4B,EAAAA;AAAF,IAAkB5B,OAAO,CAAC,mBAAD,CAA/B;;AACA,MAAM;AAAE6B,EAAAA;AAAF,IAAkD7B,OAAO,CAAC,uBAAD,CAA/D;;AAEA,MAAM8B,uBAAuB,GAAG9B,OAAO,CAAC,4BAAD,CAAP,CAAsCE,cAAtE;;AAEA,MAAM;AAAE6B,EAAAA,KAAF;AAASC,EAAAA,+BAAT;AAA0CC,EAAAA,uCAA1C;AACJC,EAAAA;AADI,IAC6BlC,OAAO,CAAC,SAAD,CAD1C;;AAEA,MAAMmC,aAAa,GAAGnC,OAAO,CAAC,mBAAD,CAA7B;;AACA,MAAMoC,OAAO,GAAGpC,OAAO,CAAC,sBAAD,CAAvB;;AACA,MAAMqC,qBAAqB,GAAGrC,OAAO,CAAC,oCAAD,CAArC;;AACA,MAAMsC,YAAY,GAAGtC,OAAO,CAAC,2BAAD,CAA5B;;AACA,MAAMuC,IAAI,GAAGvC,OAAO,CAAC,mBAAD,CAApB;;AACA,MAAMwC,gBAAgB,GAAGxC,OAAO,CAAC,+BAAD,CAAhC;;AACA,MAAMyC,iBAAiB,GAAGzC,OAAO,CAAC,gCAAD,CAAjC;;AACA,MAAM0C,wBAAwB,GAAG1C,OAAO,CAAC,6BAAD,CAAP,CAAuCE,cAAxE;;AACA,MAAMyC,cAAc,GAAG3C,OAAO,CAAC,mBAAD,CAAP,CAA6BE,cAApD;;AACA,MAAM0C,OAAO,GAAG5C,OAAO,CAAC,sBAAD,CAAvB;;AACA,MAAM6C,kBAAkB,GAAG7C,OAAO,CAAC,iCAAD,CAAlC;;AACA,MAAM8C,UAAU,GAAG9C,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAM+C,UAAU,GAAG/C,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAMgD,YAAY,GAAGhD,OAAO,CAAC,2BAAD,CAA5B;;AACA,MAAMiD,UAAU,GAAGjD,OAAO,CAAC,yBAAD,CAA1B;;AAEA,MAAMkD,WAAW,GAAGlD,OAAO,CAAC,0BAAD,CAA3B;;AACA,MAAMmD,UAAU,GAAGnD,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAMoD,KAAK,GAAGpD,OAAO,CAAC,oBAAD,CAArB;;AACA,MAAMqD,UAAU,GAAGrD,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAMsD,eAAe,GAAGtD,OAAO,CAAC,8BAAD,CAA/B;;AACA,MAAMuD,aAAa,GAAGvD,OAAO,CAAC,4BAAD,CAA7B;;AACA,MAAMwD,YAAY,GAAGxD,OAAO,CAAC,2BAAD,CAA5B;;AACA,MAAMyD,UAAU,GAAGzD,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAM0D,aAAa,GAAG1D,OAAO,CAAC,4BAAD,CAA7B;;AACA,MAAM2D,aAAa,GAAG3D,OAAO,CAAC,4BAAD,CAA7B;;AACA,MAAM4D,UAAU,GAAG5D,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAM6D,OAAO,GAAG7D,OAAO,CAAC,sBAAD,CAAvB;;AAEA,MAAM8D,cAAc,GAAG9D,OAAO,CAAC,yCAAD,CAA9B;;AACA,MAAM+D,kBAAkB,GAAG/D,OAAO,CAAC,8CAAD,CAAlC;;AACA,MAAMgE,aAAa,GAAGhE,OAAO,CAAC,wCAAD,CAA7B;;AACA,MAAMiE,yBAAyB,GAAGjE,OAAO,CAAC,sDAAD,CAAzC;;AAEA,SAASkE,eAAT,CAAyBC,IAAzB,EAA+B;AAC7B,OAAK,IAAIC,KAAK,GAAGxD,aAAa,CAACyD,UAAd,CAAyBF,IAAzB,CAAjB,EAAiDC,KAAjD,EAAwDA,KAAK,GAAGxD,aAAa,CAACyD,UAAd,CAAyBF,IAAzB,CAAhE,EAAgG;AAC9FA,IAAAA,IAAI,CAACG,WAAL,CAAiBF,KAAjB;AACD;AACF;;AAED,SAASG,GAAT,CAAaC,MAAb,EAAqB;AACnB,MAAIA,MAAM,GAAG,EAAb,EAAiB;AACf,WAAO,MAAMA,MAAb;AACD;;AACD,SAAOA,MAAP;AACD;;AAED,SAASC,oBAAT,CAA8BC,IAA9B,EAAoC;AAClC,SAAOH,GAAG,CAACG,IAAI,CAACC,QAAL,KAAkB,CAAnB,CAAH,GACL,GADK,GACCJ,GAAG,CAACG,IAAI,CAACE,OAAL,EAAD,CADJ,GAEL,GAFK,GAECF,IAAI,CAACG,WAAL,EAFD,GAGL,GAHK,GAGCN,GAAG,CAACG,IAAI,CAACI,QAAL,EAAD,CAHJ,GAIL,GAJK,GAICP,GAAG,CAACG,IAAI,CAACK,UAAL,EAAD,CAJJ,GAKL,GALK,GAKCR,GAAG,CAACG,IAAI,CAACM,UAAL,EAAD,CALX;AAMD;;AAED,MAAMC,mBAAmB,GAAG;AAC1BC,EAAAA,WAAW,EAAEhC,WADa;AAE1BiC,EAAAA,UAAU,EAAEhC,UAFc;AAG1BiC,EAAAA,KAAK,EAAEhC,KAHmB;AAI1BiC,EAAAA,MAAM,EAAEjC,KAJkB;AAK1BkC,EAAAA,UAAU,EAAEjC,UALc;AAM1BkC,EAAAA,eAAe,EAAEjC,eANS;AAO1BkC,EAAAA,UAAU,EAAEpC,KAPc;AAQ1BqC,EAAAA,aAAa,EAAElC,aARW;AAS1BmC,EAAAA,YAAY,EAAElC,YATY;AAU1BmC,EAAAA,UAAU,EAAElC,UAVc;AAW1BmC,EAAAA,WAAW,EAAEnC,UAXa;AAY1BoC,EAAAA,aAAa,EAAEnC,aAZW;AAa1BoC,EAAAA,aAAa,EAAEnC,aAbW;AAc1BoC,EAAAA,SAAS,EAAE3C,KAde;AAe1B4C,EAAAA,UAAU,EAAEpC,UAfc;AAgB1BqC,EAAAA,OAAO,EAAEpC,OAhBiB;AAiB1BqC,EAAAA,QAAQ,EAAErC;AAjBgB,CAA5B;;AAoBA,MAAMsC,YAAN,SAA2BlG,QAA3B,CAAoC;AAClCmG,EAAAA,WAAW,CAACC,IAAD,EAAOC,WAAP,EAAoB;AAC7B,UAAMD,IAAN,EAAYC,WAAZ;;AAEA,SAAKC,iBAAL;;AAEA,SAAKC,cAAL,GAAsB,IAAtB;AACA,SAAKC,QAAL,GAAgBrG,SAAS,CAACsG,aAA1B;;AACA,QAAI,CAACJ,WAAW,CAACK,OAAjB,EAA0B;AACxBL,MAAAA,WAAW,CAACK,OAAZ,GAAsB,EAAtB;AACD;;AACD,QAAI,CAACL,WAAW,CAACK,OAAZ,CAAoBC,WAAzB,EAAsC;AACpCN,MAAAA,WAAW,CAACK,OAAZ,CAAoBC,WAApB,GAAkC,KAAlC;AACD;;AACD,QAAI,CAACN,WAAW,CAACK,OAAZ,CAAoBE,QAAzB,EAAmC;AACjCP,MAAAA,WAAW,CAACK,OAAZ,CAAoBE,QAApB,GAA+B,OAA/B;AACD;;AACD,QAAI,CAACP,WAAW,CAACK,OAAZ,CAAoBG,WAAzB,EAAsC;AACpCR,MAAAA,WAAW,CAACK,OAAZ,CAAoBG,WAApB,GAAkCR,WAAW,CAACK,OAAZ,CAAoBC,WAApB,KAAoC,KAApC,GAA4C,iBAA5C,GAAgE,WAAlG;AACD;;AAED,SAAKG,YAAL,GAAoBT,WAAW,CAACK,OAAZ,CAAoBC,WAAxC;AAEA,SAAKI,eAAL,GAAuBvE,iBAAiB,CAACwE,UAAlB,CAA6B,EAA7B,EAAiC;AACtDC,MAAAA,aAAa,EAAE;AADuC,KAAjC,CAAvB;AAIA,SAAKC,YAAL,GAAoBb,WAAW,CAACK,OAAZ,CAAoBS,WAApB,IAAmC,IAAvD;AACA,SAAKC,OAAL,GAAef,WAAW,CAACK,OAAZ,CAAoBW,MAAnC;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,IAAL,GAAYC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAZ;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,cAAL,GAAsB,IAAtB;AACA,SAAKC,gBAAL,GAAwB,KAAxB;AACA,SAAKC,UAAL,GAAkBxB,WAAW,CAACK,OAAZ,CAAoBoB,SAAtC;AACA,SAAKC,aAAL,GAAqB1B,WAAW,CAACK,OAAZ,CAAoBsB,YAAzC;AACA,SAAKC,kBAAL,GAA0B5B,WAAW,CAACK,OAAZ,CAAoBwB,iBAA9C;;AACA,QAAI,KAAKL,UAAL,KAAoBM,SAAxB,EAAmC;AACjC,WAAKN,UAAL,GAAkB,IAAI/H,SAAJ,CAAc,IAAd,EAAoB;AAAEsI,QAAAA,SAAS,EAAE;AAAb,OAApB,CAAlB;AACD;;AAED,SAAKvB,WAAL,GAAmBR,WAAW,CAACK,OAAZ,CAAoBG,WAAvC;AACA,SAAKwB,SAAL,GAAiBhC,WAAW,CAACK,OAAZ,CAAoBE,QAArC;AAEA,UAAM0B,SAAS,GAAGjC,WAAW,CAACK,OAAZ,CAAoB6B,GAApB,KAA4BJ,SAA5B,GAAwC,aAAxC,GAAwD9B,WAAW,CAACK,OAAZ,CAAoB6B,GAA9F;AACA,UAAMC,MAAM,GAAG/H,SAAS,CAACgI,QAAV,CAAmBH,SAAnB,CAAf;;AACA,QAAIE,MAAM,KAAK,IAAf,EAAqB;AACnB,YAAM,IAAIE,SAAJ,CAAe,oBAAmBJ,SAAU,YAA5C,CAAN;AACD;;AAED,SAAKK,IAAL,GAAYH,MAAZ;AACA,SAAKI,MAAL,GAAcnI,SAAS,CAACoI,kBAAV,CAA6BL,MAA7B,CAAd;AAEA,SAAKM,SAAL,GAAiBzH,QAAQ,CAAC2F,UAAT,CAAoB,EAApB,EAAwB;AAAE+B,MAAAA,gBAAgB,EAAE;AAApB,KAAxB,CAAjB;AACA,SAAKC,QAAL,GAAgB5H,OAAO,CAAC4F,UAAR,CAAmB,EAAnB,EAAuB;AACrCiC,MAAAA,MAAM,EAAE,KAAK/B,YADwB;AAErCgC,MAAAA,QAAQ,EAAE,IAF2B;AAGrCC,MAAAA,2BAA2B,EAAE,MAAM,KAAKL,SAAL,CAAeM,MAAf;AAHE,KAAvB,CAAhB;AAMA,SAAKC,qBAAL,GAA6B,EAA7B;AACA,SAAKC,wBAAL,GAAgCjD,WAAW,CAACK,OAAZ,CAAoB6C,uBAApB,KAAgDpB,SAAhD,GACA,EADA,GAEAqB,MAAM,CAACnD,WAAW,CAACK,OAAZ,CAAoB6C,uBAArB,CAFtC;;AAIA,QAAIE,KAAK,CAAC,KAAKH,wBAAN,CAAT,EAA0C;AACxC,YAAM,IAAIZ,SAAJ,CAAc,uDAAd,CAAN;AACD;;AAED,QAAI,KAAKY,wBAAL,GAAgC,CAApC,EAAuC;AACrC,YAAM,IAAII,UAAJ,CAAe,oEAAf,CAAN;AACD;;AAED,SAAKC,SAAL,GAAiBtD,WAAW,CAACK,OAAZ,CAAoBkD,QAApB,IAAgC,EAAjD;AACA,SAAKC,aAAL,GAAqBrF,oBAAoB,CAAC6B,WAAW,CAACK,OAAZ,CAAoBoD,YAApB,IAAoC,IAAIC,IAAJ,EAArC,CAAzC;AACA,SAAKC,WAAL,GAAmB,IAAIlG,kBAAJ,EAAnB;AACA,SAAKmG,MAAL,GAAc,IAAIlG,aAAJ,CAAkB;AAAEmG,MAAAA,UAAU,EAAE,KAAKF,WAAnB;AAAgCG,MAAAA,MAAM,EAAE;AAAxC,KAAlB,CAAd;AACA,SAAKC,WAAL,GAAmB,IAAIrG,aAAJ,CAAkB;AAAEoG,MAAAA,MAAM,EAAE;AAAV,KAAlB,CAAnB;AACA,SAAKE,eAAL,GAAuB,IAAIxG,cAAJ,EAAvB;AACA,SAAKyG,UAAL,GAAkBjE,WAAW,CAACK,OAAZ,CAAoB4D,UAApB,IAAkC,SAApD;AAEA,SAAKC,mBAAL,GAA2B,IAA3B;AAEA,SAAKC,eAAL,GAAuB,IAAIxG,yBAAJ,CAA8B,IAA9B,CAAvB,CAlF6B,CAoF7B;AACA;AACA;;AACA,SAAKyG,YAAL,GAAoB,IAApB;AACD;;AAEDC,EAAAA,aAAa,CAACvF,KAAD,EAAQ;AACnB,QAAIA,KAAK,CAACwF,IAAN,KAAe,MAAf,IAAyB,CAAC,KAAKzD,YAAnC,EAAiD;AAC/C,aAAO,IAAP;AACD;;AAED,WAAOhH,QAAQ,CAAC0K,cAAT,CAAwB,KAAK1D,YAA7B,CAAP;AACD;;AAED,MAAI2D,UAAJ,GAAiB;AACf,WAAO,KAAK/D,YAAL,KAAsB,KAAtB,IAA+B,KAAKgE,OAApC,GAA8C,YAA9C,GAA6D,YAApE;AACD;;AACD,MAAIC,OAAJ,GAAc;AACZ,WAAO,KAAK1C,SAAZ;AACD;;AACD,MAAI2C,YAAJ,GAAmB;AACjB,WAAO,KAAK3C,SAAZ;AACD;;AACD,MAAI4C,aAAJ,GAAoB;AAClB,WAAO,KAAK5C,SAAZ;AACD;;AACD,MAAIyC,OAAJ,GAAc;AACZ,SAAK,MAAMI,SAAX,IAAwBvK,aAAa,CAACwK,gBAAd,CAA+B,IAA/B,CAAxB,EAA8D;AAC5D,UAAID,SAAS,CAAC1E,QAAV,KAAuBrG,SAAS,CAACiL,kBAArC,EAAyD;AACvD,eAAOF,SAAP;AACD;AACF;;AACD,WAAO,IAAP;AACD;;AACD,MAAIG,GAAJ,GAAU;AACR,WAAO5K,SAAS,CAAC6K,YAAV,CAAuB,KAAK3C,IAA5B,CAAP;AACD;;AACD,MAAI4C,WAAJ,GAAkB;AAChB,WAAO9K,SAAS,CAAC6K,YAAV,CAAuB,KAAK3C,IAA5B,CAAP;AACD;;AACD,MAAI6C,QAAJ,GAAe;AACb,WAAO,KAAKtE,YAAL,GAAoB,KAAK4B,SAAzB,GAAqC,IAA5C;AACD;;AACD,MAAI2C,eAAJ,GAAsB;AACpB,QAAI,KAAKnE,gBAAT,EAA2B;AACzB,aAAO,KAAKA,gBAAZ;AACD;;AAED,SAAK,MAAM4D,SAAX,IAAwBvK,aAAa,CAACwK,gBAAd,CAA+B,IAA/B,CAAxB,EAA8D;AAC5D,UAAID,SAAS,CAAC1E,QAAV,KAAuBrG,SAAS,CAACuL,YAArC,EAAmD;AACjD,aAAKpE,gBAAL,GAAwB4D,SAAxB;AACA,eAAOA,SAAP;AACD;AACF;;AAED,WAAO,IAAP;AACD;;AAED,MAAIjL,cAAJ,GAAqB;AACnB,WAAO,KAAK8G,eAAZ;AACD;;AACD,MAAI9G,cAAJ,CAAmBA,cAAnB,EAAmC;AACjC,SAAK8G,eAAL,GAAuB9G,cAAvB;AACD;;AAED,MAAIkH,WAAJ,GAAkB;AAChB,WAAO,KAAKD,YAAZ;AACD;;AAED,MAAIyE,aAAJ,GAAoB;AAClB,WAAO,KAAKhE,cAAZ;AACD;;AAED,MAAIiE,aAAJ,GAAoB;AAClB,QAAI,KAAKrB,mBAAT,EAA8B;AAC5B,aAAO,KAAKA,mBAAZ;AACD;;AAED,WAAO,KAAKsB,IAAZ;AACD;;AAEDC,EAAAA,QAAQ,GAAG;AACT,WAAOC,OAAO,CAAC,KAAKxB,mBAAN,CAAd;AACD;;AAEDyB,EAAAA,yCAAyC,CAACC,SAAD,EAAYC,SAAZ,EAAuB;AAC9D;AAEA,QAAI,KAAKC,gBAAL,CAAsBD,SAAtB,KAAoC,KAAKC,gBAAL,CAAsBD,SAAtB,EAAiCD,SAAjC,CAAxC,EAAqF;AACnF,aAAO,KAAKE,gBAAL,CAAsBD,SAAtB,EAAiCD,SAAjC,EAA4C,IAA5C,EAAkDA,SAAlD,EAA6DC,SAA7D,CAAP;AACD,KAFD,MAEO,IAAIA,SAAS,KAAKlL,OAAlB,EAA2B;AAChC,aAAO4B,kBAAkB,CAACoE,UAAnB,CAA8B,EAA9B,EAAkC;AACvCC,QAAAA,aAAa,EAAE,IADwB;AAEvCgF,QAAAA,SAFuC;AAGvCC,QAAAA;AAHuC,OAAlC,CAAP;AAKD,KANM,MAMA,IAAIA,SAAS,KAAKjL,MAAlB,EAA0B;AAC/B,aAAO4B,UAAU,CAACmE,UAAX,CAAsB,EAAtB,EAA0B;AAC/BC,QAAAA,aAAa,EAAE,IADgB;AAE/BgF,QAAAA,SAF+B;AAG/BC,QAAAA;AAH+B,OAA1B,CAAP;AAKD;;AAED,WAAOvJ,OAAO,CAACqE,UAAR,CAAmB,EAAnB,EAAuB;AAC5BC,MAAAA,aAAa,EAAE,IADa;AAE5BgF,MAAAA,SAF4B;AAG5BC,MAAAA;AAH4B,KAAvB,CAAP;AAKD;;AAEDE,EAAAA,WAAW;AAAC;AAAWC,EAAAA,GAAZ,EAAiB;AAC1B,QAAI,KAAKZ,eAAL,IAAwBY,GAAG,CAAC7F,QAAJ,KAAiBrG,SAAS,CAACuL,YAAvD,EAAqE;AACnE,YAAM,IAAIxK,YAAJ,CAAiB,mDAAjB,EAAsE,uBAAtE,CAAN;AACD;;AACD,WAAO,MAAMkL,WAAN,CAAkBC,GAAlB,CAAP;AACD;;AAEDhI,EAAAA,WAAW;AAAC;AAAWgI,EAAAA,GAAZ,EAAiB;AAC1B,UAAMC,GAAG,GAAG,MAAMjI,WAAN,CAAkBgI,GAAlB,CAAZ;;AACA,QAAIA,GAAG,KAAK,KAAK/E,gBAAjB,EAAmC;AACjC,WAAKA,gBAAL,GAAwB,IAAxB,CADiC,CACJ;AAC9B;;AACD,WAAOgF,GAAP;AACD;;AAEDC,EAAAA,kBAAkB,CAACC,MAAD,EAASrI,KAAT,EAAgB;AAChC,QAAIA,KAAK,CAACsI,OAAN,KAAkB,OAAtB,EAA+B;AAC7B,YAAMC,KAAK,GAAG,KAAKC,WAAL,CAAiBC,OAAjB,CAAyBzI,KAAK,CAAC0I,KAA/B,CAAd;;AACA,UAAIH,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,aAAKC,WAAL,CAAiBG,MAAjB,CAAwBJ,KAAxB,EAA+B,CAA/B;AACD;AACF;;AAED,UAAMH,kBAAN,CAAyBQ,KAAzB,CAA+B,IAA/B,EAAqCC,SAArC;AACD;;AAEDC,EAAAA,KAAK,GAAG;AACN,QAAIC,IAAI,GAAG,EAAX;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,SAAS,CAACI,MAA9B,EAAsC,EAAED,CAAxC,EAA2C;AACzCD,MAAAA,IAAI,IAAIG,MAAM,CAACL,SAAS,CAACG,CAAD,CAAV,CAAd;AACD;;AAED,QAAI,KAAKrG,YAAL,KAAsB,KAA1B,EAAiC;AAC/B,YAAM,IAAI5F,YAAJ,CAAiB,4CAAjB,EAA+D,mBAA/D,CAAN;AACD;;AAED,QAAI,KAAKoM,kBAAT,EAA6B;AAC3B;AACA;AACA,YAAMC,OAAO,GAAG,KAAKC,aAAL,CAAmB,KAAnB,CAAhB;AACAD,MAAAA,OAAO,CAACE,SAAR,GAAoBP,IAApB;AAEA,UAAI/I,KAAK,GAAGoJ,OAAO,CAACnJ,UAApB;AACA,UAAIsJ,QAAQ,GAAG,KAAKJ,kBAApB;AACA,YAAMd,MAAM,GAAG,KAAKc,kBAAL,CAAwBK,UAAvC;;AAEA,aAAOxJ,KAAP,EAAc;AACZ,cAAMD,IAAI,GAAGC,KAAb;AACAA,QAAAA,KAAK,GAAGA,KAAK,CAACyJ,WAAd;AAEA1J,QAAAA,IAAI,CAAC2J,2BAAL,GAAmC,IAAnC,CAJY,CAI6B;;AACzCrB,QAAAA,MAAM,CAACsB,YAAP,CAAoB5J,IAApB,EAA0BwJ,QAAQ,CAACE,WAAnC;AACA1J,QAAAA,IAAI,CAAC2J,2BAAL,GAAmC,KAAnC;AAEAH,QAAAA,QAAQ,GAAGxJ,IAAX;AACD;AACF,KApBD,MAoBO,IAAI,KAAKoG,UAAL,KAAoB,SAAxB,EAAmC;AACxC;AACA;AACA,UAAI,KAAKyD,SAAT,EAAoB;AAClB,YAAI7J,IAAI,GAAG,IAAX;;AACA,eAAOA,IAAI,CAAC6J,SAAL,IAAkB7J,IAAI,CAAC6J,SAAL,CAAevH,QAAf,KAA4BrG,SAAS,CAACuL,YAA/D,EAA6E;AAC3ExH,UAAAA,IAAI,GAAGA,IAAI,CAAC6J,SAAZ;AACD;;AACD7J,QAAAA,IAAI,CAACuJ,SAAL,GAAiBP,IAAjB;AACD,OAND,MAMO;AACLjJ,QAAAA,eAAe,CAAC,IAAD,CAAf;AACA9C,QAAAA,iBAAiB,CAAC+L,IAAD,EAAO,IAAP,CAAjB;AACD;AACF,KAbM,MAaA,IAAIA,IAAJ,EAAU;AACfjJ,MAAAA,eAAe,CAAC,IAAD,CAAf;AACA9C,MAAAA,iBAAiB,CAAC+L,IAAD,EAAO,IAAP,CAAjB;AACD;AACF;;AAEDc,EAAAA,OAAO,GAAG;AACR,SAAKf,KAAL,CAAW,GAAGD,SAAd,EAAyB,IAAzB;AACD,GAjRiC,CAmRlC;;;AACAiB,EAAAA,cAAc,CAACC,EAAD,EAAK;AACjB,QAAI,CAAC,KAAK3G,IAAL,CAAU2G,EAAV,CAAL,EAAoB;AAClB,aAAO,IAAP;AACD,KAHgB,CAKjB;;;AACA,UAAMC,YAAY,GAAG,KAAK5G,IAAL,CAAU2G,EAAV,EAAcE,IAAd,CAAmBC,SAAS,IAAI;AACnD,UAAIC,IAAI,GAAGD,SAAX;;AACA,aAAO1N,aAAa,CAAC6L,MAAd,CAAqB8B,IAArB,CAAP,EAAmC;AACjCA,QAAAA,IAAI,GAAG3N,aAAa,CAAC6L,MAAd,CAAqB8B,IAArB,CAAP;AACD;;AAED,aAAOA,IAAI,KAAK,IAAhB;AACD,KAPoB,CAArB;;AASA,WAAOH,YAAY,IAAI,IAAvB;AACD;;AAED,MAAIvE,QAAJ,GAAe;AACb,WAAO,KAAKD,SAAL,IAAkB,EAAzB;AACD;;AACD,MAAIG,YAAJ,GAAmB;AACjB,WAAO,KAAKD,aAAZ;AACD;;AACD,MAAI0E,MAAJ,GAAa;AACX,WAAO,KAAKC,oBAAL,CAA0B,KAA1B,CAAP;AACD;;AACD,MAAIC,MAAJ,GAAa;AACX,WAAO,KAAKD,oBAAL,CAA0B,OAA1B,CAAP;AACD;;AACD,MAAIE,OAAJ,GAAc;AACZ,WAAO,KAAKD,MAAZ;AACD;;AACD,MAAIE,KAAJ,GAAY;AACV,WAAOrN,cAAc,CAAC0F,UAAf,CAA0B,EAA1B,EAA8B;AACnC4H,MAAAA,OAAO,EAAE,IAD0B;AAEnCC,MAAAA,KAAK,EAAE,MAAMlO,aAAa,CAACmO,WAAd,CAA0B,IAA1B,EAAgC;AAC3CC,QAAAA,MAAM,EAAE7K,IAAI,IAAI,CAACA,IAAI,CAAC8K,UAAL,KAAoB,GAApB,IAA2B9K,IAAI,CAAC8K,UAAL,KAAoB,MAAhD,KACA9K,IAAI,CAAC+K,cAAL,CAAoB,IAApB,EAA0B,MAA1B,CADA,IAEA/K,IAAI,CAACgL,aAAL,KAAuBlO;AAHI,OAAhC;AAFsB,KAA9B,CAAP;AAQD;;AACD,MAAImO,KAAJ,GAAY;AACV,WAAO,KAAKX,oBAAL,CAA0B,MAA1B,CAAP;AACD;;AACD,MAAIY,OAAJ,GAAc;AACZ,WAAO,KAAKZ,oBAAL,CAA0B,QAA1B,CAAP;AACD;;AACD,MAAIa,OAAJ,GAAc;AACZ,WAAO/N,cAAc,CAAC0F,UAAf,CAA0B,EAA1B,EAA8B;AACnC4H,MAAAA,OAAO,EAAE,IAD0B;AAEnCC,MAAAA,KAAK,EAAE,MAAMlO,aAAa,CAACmO,WAAd,CAA0B,IAA1B,EAAgC;AAC3CC,QAAAA,MAAM,EAAE7K,IAAI,IAAIA,IAAI,CAAC8K,UAAL,KAAoB,GAApB,IACA9K,IAAI,CAAC+K,cAAL,CAAoB,IAApB,EAA0B,MAA1B,CADA,IAEA/K,IAAI,CAACgL,aAAL,KAAuBlO;AAHI,OAAhC;AAFsB,KAA9B,CAAP;AAQD,GA9UiC,CAgVlC;AACA;AACA;AACA;;;AACA,MAAIsO,OAAJ,GAAc;AACZ,WAAOhO,cAAc,CAAC0F,UAAf,CAA0B,EAA1B,EAA8B;AACnC4H,MAAAA,OAAO,EAAE,IAD0B;AAEnCC,MAAAA,KAAK,EAAE,MAAM;AAFsB,KAA9B,CAAP;AAID;;AAEDU,EAAAA,IAAI,GAAG;AACL,QAAIpL,KAAK,GAAGxD,aAAa,CAACyD,UAAd,CAAyB,IAAzB,CAAZ;;AACA,WAAOD,KAAP,EAAc;AACZ,WAAKE,WAAL,CAAiBF,KAAjB;AACAA,MAAAA,KAAK,GAAGxD,aAAa,CAACyD,UAAd,CAAyB,IAAzB,CAAR;AACD;;AACD,SAAKkD,gBAAL,GAAwB,IAAxB;;AACA,SAAKkI,SAAL;;AACA,WAAO,IAAP;AACD;;AACDC,EAAAA,KAAK,CAACC,OAAD,EAAU;AACb;AACA;AACA,QAAIA,OAAJ,EAAa;AACX,WAAKpF,UAAL,GAAkB,UAAlB;AAEA3I,MAAAA,WAAW,CAAC,kBAAD,EAAqB,IAArB,EAA2BwG,SAA3B,EAAsC;AAAEwH,QAAAA,OAAO,EAAE;AAAX,OAAtC,CAAX;AACAhO,MAAAA,WAAW,CAAC,MAAD,EAAS,IAAT,CAAX;AAEA;AACD;;AACD,SAAKsI,MAAL,CAAY2F,MAAZ;;AAEA,UAAMC,YAAY,GAAGC,OAAO,CAACC,OAAR,EAArB;;AAEA,UAAMC,gBAAgB,GAAG,MAAM;AAC7B,YAAMC,GAAG,GAAG,IAAZ;;AACA,eAASC,aAAT,GAAyB;AACvB;AACAD,QAAAA,GAAG,CAAC3F,UAAJ,GAAiB,aAAjB;AACA3I,QAAAA,WAAW,CAAC,kBAAD,EAAqBsO,GAArB,EAA0B9H,SAA1B,EAAqC;AAAEwH,UAAAA,OAAO,EAAE;AAAX,SAArC,CAAX;AACD;;AAED,aAAO,IAAIG,OAAJ,CAAYC,OAAO,IAAI;AAC5B,YAAI,CAAC,KAAK3F,WAAL,CAAiB+F,IAAtB,EAA4B;AAC1BD,UAAAA,aAAa;AACb,iBAAOH,OAAO,EAAd;AACD;;AAED,aAAK3F,WAAL,CAAiBgG,WAAjB,CAA6B,MAAM;AACjCF,UAAAA,aAAa;AACbH,UAAAA,OAAO;AACR,SAHD;;AAKA,eAAO,KAAK3F,WAAL,CAAiBwF,MAAjB,EAAP;AACD,OAZM,CAAP;AAaD,KArBD;;AAuBA,UAAMS,MAAM,GAAG,MAAM;AACnB,YAAMJ,GAAG,GAAG,IAAZ;;AACA,eAASC,aAAT,GAAyB;AACvBD,QAAAA,GAAG,CAAC3F,UAAJ,GAAiB,UAAjB;AACA3I,QAAAA,WAAW,CAAC,MAAD,EAASsO,GAAT,CAAX;AACD;;AAED,aAAO,IAAIH,OAAJ,CAAYC,OAAO,IAAI;AAC5B,YAAI,KAAK/F,WAAL,CAAiBsG,KAAjB,OAA6B,CAAjC,EAAoC;AAClCJ,UAAAA,aAAa;AACb,iBAAOH,OAAO,EAAd;AACD;;AAED,eAAO,KAAK/F,WAAL,CAAiBoG,WAAjB,CAA6B,MAAM;AACxCF,UAAAA,aAAa;AACbH,UAAAA,OAAO;AACR,SAHM,CAAP;AAID,OAVM,CAAP;AAWD,KAlBD;;AAoBA,SAAK9F,MAAL,CAAYsG,IAAZ,CAAiBV,YAAjB,EAA+BG,gBAA/B,EAAiD,IAAjD,EA1Da,CA2Db;AACA;;;AACA,SAAK/F,MAAL,CAAYsG,IAAZ,CAAiBV,YAAjB,EAA+BQ,MAA/B,EAAuC,IAAvC,EAA6C,IAA7C;AACD;;AAEDG,EAAAA,iBAAiB,CAACC,WAAD,EAAc;AAC7B,WAAOlP,QAAQ,CAACyF,UAAT,CAAoB,EAApB,EAAwB;AAC7B4H,MAAAA,OAAO,EAAE,IADoB;AAE7BC,MAAAA,KAAK,EAAE,MAAMlO,aAAa,CAACmO,WAAd,CAA0B,IAA1B,EAAgC;AAC3CC,QAAAA,MAAM,EAAE7K,IAAI,IAAIA,IAAI,CAACwM,cAAL,IAAuBxM,IAAI,CAACwM,cAAL,CAAoB,IAApB,EAA0B,MAA1B,MAAsCD;AADlC,OAAhC;AAFgB,KAAxB,CAAP;AAMD;;AAED,MAAIE,KAAJ,GAAY;AACV,UAAM;AAAElF,MAAAA;AAAF,QAAsB,IAA5B;AACA,QAAImF,KAAK,GAAG,EAAZ;;AAEA,QAAInF,eAAe,IAAIA,eAAe,CAACuD,UAAhB,KAA+B,KAAtD,EAA6D;AAC3D,YAAM6B,eAAe,GAAGvQ,uBAAuB,CAACmL,eAAD,EAAkB,OAAlB,EAA2BxK,MAA3B,CAA/C;;AAEA,UAAI4P,eAAJ,EAAqB;AACnBD,QAAAA,KAAK,GAAG7P,gBAAgB,CAAC8P,eAAD,CAAxB;AACD;AACF,KAND,MAMO;AACL,YAAMC,YAAY,GAAGtQ,4BAA4B,CAAC,IAAD,EAAO,OAAP,CAAjD;;AAEA,UAAIsQ,YAAJ,EAAkB;AAChBF,QAAAA,KAAK,GAAG7P,gBAAgB,CAAC+P,YAAD,CAAxB;AACD;AACF;;AAEDF,IAAAA,KAAK,GAAG9P,+BAA+B,CAAC8P,KAAD,CAAvC;AAEA,WAAOA,KAAP;AACD;;AAED,MAAID,KAAJ,CAAUC,KAAV,EAAiB;AACf,UAAM;AAAEnF,MAAAA;AAAF,QAAsB,IAA5B;AACA,QAAImD,OAAJ;;AAEA,QAAInD,eAAe,IAAIA,eAAe,CAACuD,UAAhB,KAA+B,KAAtD,EAA6D;AAC3DJ,MAAAA,OAAO,GAAGtO,uBAAuB,CAACmL,eAAD,EAAkB,OAAlB,EAA2BxK,MAA3B,CAAjC;;AAEA,UAAI,CAAC2N,OAAL,EAAc;AACZA,QAAAA,OAAO,GAAG,KAAKmC,eAAL,CAAqB9P,MAArB,EAA6B,OAA7B,CAAV;;AAEA,aAAK+P,OAAL,CAAapC,OAAb,EAAsBnD,eAAe,CAACrH,UAAtC;AACD;;AAEDwK,MAAAA,OAAO,CAACqC,WAAR,GAAsBL,KAAtB;AACD,KAVD,MAUO,IAAInF,eAAe,IAAIA,eAAe,CAACyD,aAAhB,KAAkClO,OAAzD,EAAkE;AACvE,YAAM8P,YAAY,GAAGtQ,4BAA4B,CAAC,IAAD,EAAO,OAAP,CAAjD;AACA,YAAM0Q,WAAW,GAAG,KAAKC,IAAzB;;AAEA,UAAIL,YAAY,KAAK,IAAjB,IAAyBI,WAAW,KAAK,IAA7C,EAAmD;AACjD;AACD;;AAED,UAAIJ,YAAY,KAAK,IAArB,EAA2B;AACzBlC,QAAAA,OAAO,GAAGkC,YAAV;AACD,OAFD,MAEO;AACLlC,QAAAA,OAAO,GAAG,KAAKpB,aAAL,CAAmB,OAAnB,CAAV;;AACA0D,QAAAA,WAAW,CAACE,OAAZ,CAAoBxC,OAApB;AACD;;AAEDA,MAAAA,OAAO,CAACqC,WAAR,GAAsBL,KAAtB;AACD;AACF;;AAED,MAAIS,GAAJ,GAAU;AACR,WAAO,KAAK5F,eAAL,GAAuB,KAAKA,eAAL,CAAqB4F,GAA5C,GAAkD,EAAzD;AACD;;AACD,MAAIA,GAAJ,CAAQT,KAAR,EAAe;AACb,QAAI,KAAKnF,eAAT,EAA0B;AACxB,WAAKA,eAAL,CAAqB4F,GAArB,GAA2BT,KAA3B;AACD;AACF;;AAED,MAAIO,IAAJ,GAAW;AACT,WAAO,KAAK1F,eAAL,GAAuBnL,uBAAuB,CAAC,KAAKmL,eAAN,EAAuB,MAAvB,CAA9C,GAA+E,IAAtF;AACD;;AAED,MAAII,IAAJ,GAAW;AACT,UAAM;AAAEJ,MAAAA;AAAF,QAAsB,IAA5B;;AACA,QAAI,CAACA,eAAD,IAAoBA,eAAe,CAACuD,UAAhB,KAA+B,MAAnD,IACAvD,eAAe,CAACyD,aAAhB,KAAkClO,OADtC,EAC+C;AAC7C,aAAO,IAAP;AACD;;AAED,WAAOT,wBAAwB,CAAC,KAAKkL,eAAN,EAAuB,IAAI6F,GAAJ,CAAQ,CAAC,MAAD,EAAS,UAAT,CAAR,CAAvB,CAA/B;AACD;;AAED,MAAIzF,IAAJ,CAAS+E,KAAT,EAAgB;AACd,QAAIA,KAAK,KAAK,IAAV,IACAA,KAAK,CAAC1B,aAAN,KAAwBlO,OADxB,IAEC4P,KAAK,CAAC5B,UAAN,KAAqB,MAArB,IAA+B4B,KAAK,CAAC5B,UAAN,KAAqB,UAFzD,EAEsE;AACpE,YAAM,IAAI9N,YAAJ,CAAiB,4DAAjB,EAA+E,uBAA/E,CAAN;AACD;;AAED,UAAMqQ,WAAW,GAAG,KAAK1F,IAAzB;;AACA,QAAI+E,KAAK,KAAKW,WAAd,EAA2B;AACzB;AACD;;AAED,QAAIA,WAAW,KAAK,IAApB,EAA0B;AACxBA,MAAAA,WAAW,CAAC5D,UAAZ,CAAuB6D,QAAvB,CAAgCZ,KAAhC,EAAuCW,WAAvC;;AACA;AACD;;AAED,UAAM;AAAE9F,MAAAA;AAAF,QAAsB,IAA5B;;AACA,QAAIA,eAAe,KAAK,IAAxB,EAA8B;AAC5B,YAAM,IAAIvK,YAAJ,CAAiB,uDAAjB,EAA0E,uBAA1E,CAAN;AACD;;AAEDuK,IAAAA,eAAe,CAAC2F,OAAhB,CAAwBR,KAAxB;AACD;;AAEDa,EAAAA,oBAAoB,CAACC,OAAD,EAAU;AAC5B,SAAK,MAAMC,kBAAX,IAAiC,KAAKtI,qBAAtC,EAA6D;AAC3DsI,MAAAA,kBAAkB,CAACC,iBAAnB,CAAqCF,OAArC;AACD;AACF;;AAEDG,EAAAA,WAAW,CAAClH,IAAD,EAAO;AAChB,UAAMmH,SAAS,GAAGnH,IAAI,CAACoH,WAAL,EAAlB;AACA,UAAMC,YAAY,GAAGhN,mBAAmB,CAAC8M,SAAD,CAAnB,IAAkC,IAAvD;;AAEA,QAAI,CAACE,YAAL,EAAmB;AACjB,YAAM,IAAI9Q,YAAJ,CAAiB,gCAAgCyJ,IAAhC,GAAuC,gBAAxD,EAA0E,mBAA1E,CAAN;AACD;;AAED,UAAMsH,IAAI,GAAGD,YAAY,CAAChL,UAAb,CAAwB,CAAC,EAAD,CAAxB,CAAb;AACAiL,IAAAA,IAAI,CAACC,gBAAL,GAAwB,KAAxB;AACA,WAAOD,IAAP;AACD;;AAEDE,EAAAA,2BAA2B,CAACC,MAAD,EAASC,IAAT,EAAe;AACxC7Q,IAAAA,YAAY,CAAC4Q,MAAD,CAAZ;;AAEA,QAAIC,IAAI,CAACC,QAAL,CAAc,IAAd,CAAJ,EAAyB;AACvB,YAAM,IAAIpR,YAAJ,CAAiB,8DAAjB,EAAiF,uBAAjF,CAAN;AACD;;AAED,WAAOkB,qBAAqB,CAAC4E,UAAtB,CAAiC,EAAjC,EAAqC;AAC1CC,MAAAA,aAAa,EAAE,IAD2B;AAE1CmL,MAAAA,MAF0C;AAG1CC,MAAAA;AAH0C,KAArC,CAAP;AAKD,GArjBiC,CAujBlC;;;AACAE,EAAAA,kBAAkB,CAACF,IAAD,EAAO;AACvB,QAAI,KAAKvL,YAAL,KAAsB,MAA1B,EAAkC;AAChC,YAAM,IAAI5F,YAAJ,CAAiB,gDAAjB,EAAmE,mBAAnE,CAAN;AACD;;AAED,QAAImR,IAAI,CAACC,QAAL,CAAc,KAAd,CAAJ,EAA0B;AACxB,YAAM,IAAIpR,YAAJ,CAAiB,sDAAjB,EAAyE,uBAAzE,CAAN;AACD;;AAED,WAAOmB,YAAY,CAAC2E,UAAb,CAAwB,EAAxB,EAA4B;AACjCC,MAAAA,aAAa,EAAE,IADkB;AAEjCoL,MAAAA;AAFiC,KAA5B,CAAP;AAID;;AAEDG,EAAAA,cAAc,CAACH,IAAD,EAAO;AACnB,WAAO/P,IAAI,CAAC0E,UAAL,CAAgB,EAAhB,EAAoB;AACzBC,MAAAA,aAAa,EAAE,IADU;AAEzBoL,MAAAA;AAFyB,KAApB,CAAP;AAID;;AAEDI,EAAAA,aAAa,CAACJ,IAAD,EAAO;AAClB,WAAOlQ,OAAO,CAAC6E,UAAR,CAAmB,EAAnB,EAAuB;AAC5BC,MAAAA,aAAa,EAAE,IADa;AAE5BoL,MAAAA;AAF4B,KAAvB,CAAP;AAID;;AAED7E,EAAAA,aAAa,CAACvB,SAAD,EAAY;AACvBzK,IAAAA,YAAY,CAACyK,SAAD,CAAZ;;AACA,QAAI,KAAKnF,YAAL,KAAsB,MAA1B,EAAkC;AAChCmF,MAAAA,SAAS,GAAGpL,cAAc,CAACoL,SAAD,CAA1B;AACD;;AAED,UAAMC,SAAS,GAAG,KAAKpF,YAAL,KAAsB,MAAtB,IAAgC,KAAKD,WAAL,KAAqB,uBAArD,GAA+E7F,OAA/E,GAAyF,IAA3G;AAEA,WAAO,KAAKgL,yCAAL,CAA+CC,SAA/C,EAA0DC,SAA1D,CAAP;AACD;;AAED6E,EAAAA,eAAe,CAAC7E,SAAD,EAAYwG,aAAZ,EAA2B;AACxCxG,IAAAA,SAAS,GAAGA,SAAS,KAAK,IAAd,GAAqBmB,MAAM,CAACnB,SAAD,CAA3B,GAAyCA,SAArD;AAEA,UAAMyG,SAAS,GAAGjR,kBAAkB,CAACwK,SAAD,EAAYwG,aAAZ,CAApC;;AAEA,UAAM9D,OAAO,GAAG,KAAK5C,yCAAL,CAA+C2G,SAAS,CAAC1G,SAAzD,EAAoE0G,SAAS,CAACzG,SAA9E,CAAhB;;AACA0C,IAAAA,OAAO,CAACgE,OAAR,GAAkBD,SAAS,CAACE,MAA5B;AAEA,WAAOjE,OAAP;AACD;;AAEDkE,EAAAA,sBAAsB,GAAG;AACvB,WAAOvQ,gBAAgB,CAACyE,UAAjB,CAA4B,EAA5B,EAAgC;AAAEC,MAAAA,aAAa,EAAE;AAAjB,KAAhC,CAAP;AACD;;AAED8L,EAAAA,eAAe,CAAC9G,SAAD,EAAY;AACzBzK,IAAAA,YAAY,CAACyK,SAAD,CAAZ;;AAEA,QAAI,KAAKnF,YAAL,KAAsB,MAA1B,EAAkC;AAChCmF,MAAAA,SAAS,GAAGpL,cAAc,CAACoL,SAAD,CAA1B;AACD;;AAED,WAAO/J,aAAa,CAAC8E,UAAd,CAAyB,EAAzB,EAA6B;AAAEiF,MAAAA;AAAF,KAA7B,CAAP;AACD;;AAED+G,EAAAA,iBAAiB,CAAC9G,SAAD,EAAYzK,IAAZ,EAAkB;AACjC,QAAIyK,SAAS,KAAK/D,SAAlB,EAA6B;AAC3B+D,MAAAA,SAAS,GAAG,IAAZ;AACD;;AACDA,IAAAA,SAAS,GAAGA,SAAS,KAAK,IAAd,GAAqBmB,MAAM,CAACnB,SAAD,CAA3B,GAAyCA,SAArD;AAEA,UAAMyG,SAAS,GAAGjR,kBAAkB,CAACwK,SAAD,EAAYzK,IAAZ,CAApC;AACA,WAAOS,aAAa,CAAC8E,UAAd,CAAyB,EAAzB,EAA6B;AAClCkF,MAAAA,SAAS,EAAEyG,SAAS,CAACzG,SADa;AAElC+G,MAAAA,eAAe,EAAEN,SAAS,CAACE,MAFO;AAGlC5G,MAAAA,SAAS,EAAE0G,SAAS,CAAC1G;AAHa,KAA7B,CAAP;AAKD,GAroBiC,CAuoBlC;;;AACAiH,EAAAA,gBAAgB,CAAC5E,IAAD,EAAO6E,UAAP,EAAmBpE,MAAnB,EAA2B;AACzC,WAAOjM,UAAU,CAACkE,UAAX,CAAsB,EAAtB,EAA0B;AAAEsH,MAAAA,IAAF;AAAQ6E,MAAAA,UAAR;AAAoBpE,MAAAA;AAApB,KAA1B,CAAP;AACD;;AAEDqE,EAAAA,kBAAkB,CAAC9E,IAAD,EAAO6E,UAAP,EAAmBpE,MAAnB,EAA2B;AAC3C,UAAMsE,YAAY,GAAGtQ,YAAY,CAACiE,UAAb,CAAwB,EAAxB,EAA4B;AAAEsH,MAAAA,IAAF;AAAQ6E,MAAAA,UAAR;AAAoBpE,MAAAA;AAApB,KAA5B,CAArB;;AAEA,SAAK1F,qBAAL,CAA2BkH,IAA3B,CAAgC8C,YAAhC;;AACA,WAAO,KAAKhK,qBAAL,CAA2B+D,MAA3B,GAAoC,KAAK9D,wBAAhD,EAA0E;AACxE,YAAMgK,YAAY,GAAG,KAAKjK,qBAAL,CAA2BkK,KAA3B,EAArB;;AACAD,MAAAA,YAAY,CAACE,QAAb,GAAwB,KAAxB;AACD;;AAED,WAAOH,YAAP;AACD;;AAEDI,EAAAA,UAAU,CAACvP,IAAD,EAAOwP,IAAP,EAAa;AACrB,QAAIxP,IAAI,CAACsC,QAAL,KAAkBrG,SAAS,CAACsG,aAAhC,EAA+C;AAC7C,YAAM,IAAIvF,YAAJ,CAAiB,+BAAjB,EAAkD,mBAAlD,CAAN;AACD,KAFD,MAEO,IAAI8B,UAAU,CAAC2Q,MAAX,CAAkBzP,IAAlB,CAAJ,EAA6B;AAClC,YAAM,IAAIhD,YAAJ,CAAiB,4BAAjB,EAA+C,mBAA/C,CAAN;AACD;;AAED,WAAOY,KAAK,CAACoC,IAAD,EAAO,IAAP,EAAawP,IAAb,CAAZ;AACD,GAhqBiC,CAkqBlC;;;AACAE,EAAAA,SAAS,CAAC1P,IAAD,EAAO;AACd,QAAIA,IAAI,CAACsC,QAAL,KAAkBrG,SAAS,CAACsG,aAAhC,EAA+C;AAC7C,YAAM,IAAIvF,YAAJ,CAAiB,8BAAjB,EAAiD,mBAAjD,CAAN;AACD,KAFD,MAEO,IAAI8B,UAAU,CAAC2Q,MAAX,CAAkBzP,IAAlB,CAAJ,EAA6B;AAClC,YAAM,IAAIhD,YAAJ,CAAiB,4BAAjB,EAA+C,uBAA/C,CAAN;AACD;;AAED,SAAK2S,UAAL,CAAgB3P,IAAhB;;AAEA,WAAOA,IAAP;AACD,GA7qBiC,CA+qBlC;;;AACA2P,EAAAA,UAAU,CAAC3P,IAAD,EAAO;AACf,UAAM4P,WAAW,GAAG,IAApB;AACA,UAAMC,WAAW,GAAG7P,IAAI,CAACqC,cAAzB;AAEA,UAAMiG,MAAM,GAAG7L,aAAa,CAAC6L,MAAd,CAAqBtI,IAArB,CAAf;;AACA,QAAIsI,MAAJ,EAAY;AACVA,MAAAA,MAAM,CAACwH,OAAP,CAAe9P,IAAf;AACD;;AAED,QAAI6P,WAAW,KAAKD,WAApB,EAAiC;AAC/B,WAAK,MAAMG,mBAAX,IAAkCrS,2CAA2C,CAACsC,IAAD,CAA7E,EAAqF;AACnF+P,QAAAA,mBAAmB,CAAC1N,cAApB,GAAqCuN,WAArC;AACD;;AAED,WAAK,MAAMG,mBAAX,IAAkCrS,2CAA2C,CAACsC,IAAD,CAA7E,EAAqF;AACnF,YAAI+P,mBAAmB,CAACC,cAAxB,EAAwC;AACtCD,UAAAA,mBAAmB,CAACC,cAApB,CAAmCH,WAAnC;AACD;AACF;AACF;AACF;;AAED,MAAII,MAAJ,GAAa;AACX,WAAO,KAAKtM,UAAL,CAAgBuM,mBAAhB,CAAoC,KAAK/I,GAAzC,EAA8C;AAAEgJ,MAAAA,IAAI,EAAE;AAAR,KAA9C,CAAP;AACD;;AACD,MAAIF,MAAJ,CAAWG,SAAX,EAAsB;AACpBA,IAAAA,SAAS,GAAGjH,MAAM,CAACiH,SAAD,CAAlB;;AACA,SAAKzM,UAAL,CAAgB0M,aAAhB,CAA8BD,SAA9B,EAAyC,KAAKjJ,GAA9C,EAAmD;AACjDgJ,MAAAA,IAAI,EAAE,KAD2C;AAEjDG,MAAAA,WAAW,EAAE;AAFoC,KAAnD;AAID,GA/sBiC,CAitBlC;;;AACAC,EAAAA,KAAK,GAAG,CAAE;;AAEVC,EAAAA,aAAa,GAAG,CAAE;;AAElBC,EAAAA,aAAa,GAAG,CAAE;;AAElB,MAAIhI,WAAJ,GAAkB;AAChB,QAAI,CAAC,KAAKiI,YAAV,EAAwB;AACtB,WAAKA,YAAL,GAAoB,IAAIlU,cAAJ,EAApB;AACD,KAHe,CAKhB;AACA;;;AACA,WAAO,KAAKkU,YAAZ;AACD;;AAED,MAAIC,MAAJ,GAAa;AACX,QAAI,KAAK3N,YAAL,IAAqB,KAAKA,YAAL,CAAkB4N,kBAA3C,EAA+D;AAC7D,aAAO,KAAP;AACD;;AAED,WAAO,IAAP;AACD;;AAED,MAAIC,eAAJ,GAAsB;AACpB,QAAI,KAAK7N,YAAL,IAAqB,KAAKA,YAAL,CAAkB4N,kBAA3C,EAA+D;AAC7D,aAAO,SAAP;AACD;;AAED,WAAO,WAAP;AACD;;AAhvBiC;;AAmvBpClU,cAAc,CAACoU,mBAAf,CAAmC9O,YAAY,CAAC+O,SAAhD,EAA2D,kBAA3D;AACA7U,KAAK,CAAC8F,YAAY,CAAC+O,SAAd,EAAyBpT,uBAAuB,CAACoT,SAAjD,CAAL;AACA7U,KAAK,CAAC8F,YAAY,CAAC+O,SAAd,EAAyBxS,wBAAwB,CAACwS,SAAlD,CAAL;AACA7U,KAAK,CAAC8F,YAAY,CAAC+O,SAAd,EAAyBvS,cAAc,CAACuS,SAAxC,CAAL;AAEA/O,YAAY,CAAC+O,SAAb,CAAuB9I,gBAAvB,GAA0C3E,MAAM,CAACC,MAAP,CAAc,IAAd,CAA1C;AAEAvB,YAAY,CAAC+O,SAAb,CAAuBzG,oBAAvB,GAA8CnO,YAAY,CAAC,UAAUqS,aAAV,EAAyB;AAClF,SAAO3Q,+BAA+B,CAAC2Q,aAAD,EAAgB,IAAhB,CAAtC;AACD,CAFyD,CAA1D;AAIAxM,YAAY,CAAC+O,SAAb,CAAuBC,sBAAvB,GAAgD7U,YAAY,CAAC,UAAU6L,SAAV,EAAqBD,SAArB,EAAgC;AAC3F,SAAOjK,uCAAuC,CAACkK,SAAD,EAAYD,SAAZ,EAAuB,IAAvB,CAA9C;AACD,CAF2D,CAA5D;AAIA/F,YAAY,CAAC+O,SAAb,CAAuBE,sBAAvB,GAAgD9U,YAAY,CAAC,SAAS8U,sBAAT,CAAgCC,UAAhC,EAA4C;AACvG,SAAOnT,4BAA4B,CAACmT,UAAD,EAAa,IAAb,CAAnC;AACD,CAF2D,CAA5D;AAIAC,MAAM,CAACC,OAAP,GAAiB;AACfrV,EAAAA,cAAc,EAAEiG;AADD,CAAjB","sourcesContent":["\"use strict\";\n\nconst { CookieJar } = require(\"tough-cookie\");\n\nconst NodeImpl = require(\"./Node-impl\").implementation;\nconst idlUtils = require(\"../generated/utils\");\nconst NODE_TYPE = require(\"../node-type\");\nconst { mixin, memoizeQuery } = require(\"../../utils\");\nconst { firstChildWithLocalName, firstChildWithLocalNames, firstDescendantWithLocalName } =\n  require(\"../helpers/traversal\");\nconst whatwgURL = require(\"whatwg-url\");\nconst { StyleSheetList } = require(\"../../level2/style\");\nconst { domSymbolTree } = require(\"../helpers/internal-constants\");\nconst eventAccessors = require(\"../helpers/create-event-accessor\");\nconst { asciiLowercase, stripAndCollapseASCIIWhitespace } = require(\"../helpers/strings\");\nconst { childTextContent } = require(\"../helpers/text\");\nconst { HTML_NS, SVG_NS } = require(\"../helpers/namespaces\");\nconst DOMException = require(\"domexception\");\nconst { parseIntoDocument } = require(\"../../browser/parser\");\nconst History = require(\"../generated/History\");\nconst Location = require(\"../generated/Location\");\nconst HTMLCollection = require(\"../generated/HTMLCollection\");\nconst NodeList = require(\"../generated/NodeList\");\nconst validateName = require(\"../helpers/validate-names\").name;\nconst { validateAndExtract } = require(\"../helpers/validate-names\");\nconst { fireAnEvent } = require(\"../helpers/events\");\nconst { shadowIncludingInclusiveDescendantsIterator } = require(\"../helpers/shadow-dom\");\n\nconst GlobalEventHandlersImpl = require(\"./GlobalEventHandlers-impl\").implementation;\n\nconst { clone, listOfElementsWithQualifiedName, listOfElementsWithNamespaceAndLocalName,\n  listOfElementsWithClassNames } = require(\"../node\");\nconst generatedAttr = require(\"../generated/Attr\");\nconst Comment = require(\"../generated/Comment\");\nconst ProcessingInstruction = require(\"../generated/ProcessingInstruction\");\nconst CDATASection = require(\"../generated/CDATASection\");\nconst Text = require(\"../generated/Text\");\nconst DocumentFragment = require(\"../generated/DocumentFragment\");\nconst DOMImplementation = require(\"../generated/DOMImplementation\");\nconst NonElementParentNodeImpl = require(\"./NonElementParentNode-impl\").implementation;\nconst ParentNodeImpl = require(\"./ParentNode-impl\").implementation;\nconst Element = require(\"../generated/Element\");\nconst HTMLUnknownElement = require(\"../generated/HTMLUnknownElement\");\nconst SVGElement = require(\"../generated/SVGElement\");\nconst TreeWalker = require(\"../generated/TreeWalker\");\nconst NodeIterator = require(\"../generated/NodeIterator\");\nconst ShadowRoot = require(\"../generated/ShadowRoot\");\n\nconst CustomEvent = require(\"../generated/CustomEvent\");\nconst ErrorEvent = require(\"../generated/ErrorEvent\");\nconst Event = require(\"../generated/Event\");\nconst FocusEvent = require(\"../generated/FocusEvent\");\nconst HashChangeEvent = require(\"../generated/HashChangeEvent\");\nconst KeyboardEvent = require(\"../generated/KeyboardEvent\");\nconst MessageEvent = require(\"../generated/MessageEvent\");\nconst MouseEvent = require(\"../generated/MouseEvent\");\nconst PopStateEvent = require(\"../generated/PopStateEvent\");\nconst ProgressEvent = require(\"../generated/ProgressEvent\");\nconst TouchEvent = require(\"../generated/TouchEvent\");\nconst UIEvent = require(\"../generated/UIEvent\");\n\nconst RequestManager = require(\"../../browser/resources/request-manager\");\nconst AsyncResourceQueue = require(\"../../browser/resources/async-resource-queue\");\nconst ResourceQueue = require(\"../../browser/resources/resource-queue\");\nconst PerDocumentResourceLoader = require(\"../../browser/resources/per-document-resource-loader\");\n\nfunction clearChildNodes(node) {\n  for (let child = domSymbolTree.firstChild(node); child; child = domSymbolTree.firstChild(node)) {\n    node.removeChild(child);\n  }\n}\n\nfunction pad(number) {\n  if (number < 10) {\n    return \"0\" + number;\n  }\n  return number;\n}\n\nfunction toLastModifiedString(date) {\n  return pad(date.getMonth() + 1) +\n    \"/\" + pad(date.getDate()) +\n    \"/\" + date.getFullYear() +\n    \" \" + pad(date.getHours()) +\n    \":\" + pad(date.getMinutes()) +\n    \":\" + pad(date.getSeconds());\n}\n\nconst eventInterfaceTable = {\n  customevent: CustomEvent,\n  errorevent: ErrorEvent,\n  event: Event,\n  events: Event,\n  focusevent: FocusEvent,\n  hashchangeevent: HashChangeEvent,\n  htmlevents: Event,\n  keyboardevent: KeyboardEvent,\n  messageevent: MessageEvent,\n  mouseevent: MouseEvent,\n  mouseevents: MouseEvent,\n  popstateevent: PopStateEvent,\n  progressevent: ProgressEvent,\n  svgevents: Event,\n  touchevent: TouchEvent,\n  uievent: UIEvent,\n  uievents: UIEvent\n};\n\nclass DocumentImpl extends NodeImpl {\n  constructor(args, privateData) {\n    super(args, privateData);\n\n    this._initGlobalEvents();\n\n    this._ownerDocument = this;\n    this.nodeType = NODE_TYPE.DOCUMENT_NODE;\n    if (!privateData.options) {\n      privateData.options = {};\n    }\n    if (!privateData.options.parsingMode) {\n      privateData.options.parsingMode = \"xml\";\n    }\n    if (!privateData.options.encoding) {\n      privateData.options.encoding = \"UTF-8\";\n    }\n    if (!privateData.options.contentType) {\n      privateData.options.contentType = privateData.options.parsingMode === \"xml\" ? \"application/xml\" : \"text/html\";\n    }\n\n    this._parsingMode = privateData.options.parsingMode;\n\n    this._implementation = DOMImplementation.createImpl([], {\n      ownerDocument: this\n    });\n\n    this._defaultView = privateData.options.defaultView || null;\n    this._global = privateData.options.global;\n    this._documentElement = null;\n    this._ids = Object.create(null);\n    this._attached = true;\n    this._currentScript = null;\n    this._pageShowingFlag = false;\n    this._cookieJar = privateData.options.cookieJar;\n    this._parseOptions = privateData.options.parseOptions;\n    this._scriptingDisabled = privateData.options.scriptingDisabled;\n    if (this._cookieJar === undefined) {\n      this._cookieJar = new CookieJar(null, { looseMode: true });\n    }\n\n    this.contentType = privateData.options.contentType;\n    this._encoding = privateData.options.encoding;\n\n    const urlOption = privateData.options.url === undefined ? \"about:blank\" : privateData.options.url;\n    const parsed = whatwgURL.parseURL(urlOption);\n    if (parsed === null) {\n      throw new TypeError(`Could not parse \"${urlOption}\" as a URL`);\n    }\n\n    this._URL = parsed;\n    this.origin = whatwgURL.serializeURLOrigin(parsed);\n\n    this._location = Location.createImpl([], { relevantDocument: this });\n    this._history = History.createImpl([], {\n      window: this._defaultView,\n      document: this,\n      actAsIfLocationReloadCalled: () => this._location.reload()\n    });\n\n    this._workingNodeIterators = [];\n    this._workingNodeIteratorsMax = privateData.options.concurrentNodeIterators === undefined ?\n                                    10 :\n                                    Number(privateData.options.concurrentNodeIterators);\n\n    if (isNaN(this._workingNodeIteratorsMax)) {\n      throw new TypeError(\"The 'concurrentNodeIterators' option must be a Number\");\n    }\n\n    if (this._workingNodeIteratorsMax < 0) {\n      throw new RangeError(\"The 'concurrentNodeIterators' option must be a non negative Number\");\n    }\n\n    this._referrer = privateData.options.referrer || \"\";\n    this._lastModified = toLastModifiedString(privateData.options.lastModified || new Date());\n    this._asyncQueue = new AsyncResourceQueue();\n    this._queue = new ResourceQueue({ asyncQueue: this._asyncQueue, paused: false });\n    this._deferQueue = new ResourceQueue({ paused: true });\n    this._requestManager = new RequestManager();\n    this.readyState = privateData.options.readyState || \"loading\";\n\n    this._lastFocusedElement = null;\n\n    this._resourceLoader = new PerDocumentResourceLoader(this);\n\n    // Each Document in a browsing context can also have a latest entry. This is the entry for that Document\n    // to which the browsing context's session history was most recently traversed. When a Document is created,\n    // it initially has no latest entry.\n    this._latestEntry = null;\n  }\n\n  _getTheParent(event) {\n    if (event.type === \"load\" || !this._defaultView) {\n      return null;\n    }\n\n    return idlUtils.implForWrapper(this._defaultView);\n  }\n\n  get compatMode() {\n    return this._parsingMode === \"xml\" || this.doctype ? \"CSS1Compat\" : \"BackCompat\";\n  }\n  get charset() {\n    return this._encoding;\n  }\n  get characterSet() {\n    return this._encoding;\n  }\n  get inputEncoding() {\n    return this._encoding;\n  }\n  get doctype() {\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n        return childNode;\n      }\n    }\n    return null;\n  }\n  get URL() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n  get documentURI() {\n    return whatwgURL.serializeURL(this._URL);\n  }\n  get location() {\n    return this._defaultView ? this._location : null;\n  }\n  get documentElement() {\n    if (this._documentElement) {\n      return this._documentElement;\n    }\n\n    for (const childNode of domSymbolTree.childrenIterator(this)) {\n      if (childNode.nodeType === NODE_TYPE.ELEMENT_NODE) {\n        this._documentElement = childNode;\n        return childNode;\n      }\n    }\n\n    return null;\n  }\n\n  get implementation() {\n    return this._implementation;\n  }\n  set implementation(implementation) {\n    this._implementation = implementation;\n  }\n\n  get defaultView() {\n    return this._defaultView;\n  }\n\n  get currentScript() {\n    return this._currentScript;\n  }\n\n  get activeElement() {\n    if (this._lastFocusedElement) {\n      return this._lastFocusedElement;\n    }\n\n    return this.body;\n  }\n\n  hasFocus() {\n    return Boolean(this._lastFocusedElement);\n  }\n\n  _createElementWithCorrectElementInterface(localName, namespace) {\n    // https://dom.spec.whatwg.org/#concept-element-interface\n\n    if (this._elementBuilders[namespace] && this._elementBuilders[namespace][localName]) {\n      return this._elementBuilders[namespace][localName](this, localName, namespace);\n    } else if (namespace === HTML_NS) {\n      return HTMLUnknownElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    } else if (namespace === SVG_NS) {\n      return SVGElement.createImpl([], {\n        ownerDocument: this,\n        localName,\n        namespace\n      });\n    }\n\n    return Element.createImpl([], {\n      ownerDocument: this,\n      localName,\n      namespace\n    });\n  }\n\n  appendChild(/* Node */ arg) {\n    if (this.documentElement && arg.nodeType === NODE_TYPE.ELEMENT_NODE) {\n      throw new DOMException(\"The operation would yield an incorrect node tree.\", \"HierarchyRequestError\");\n    }\n    return super.appendChild(arg);\n  }\n\n  removeChild(/* Node */ arg) {\n    const ret = super.removeChild(arg);\n    if (arg === this._documentElement) {\n      this._documentElement = null;// force a recalculation\n    }\n    return ret;\n  }\n\n  _descendantRemoved(parent, child) {\n    if (child.tagName === \"STYLE\") {\n      const index = this.styleSheets.indexOf(child.sheet);\n      if (index > -1) {\n        this.styleSheets.splice(index, 1);\n      }\n    }\n\n    super._descendantRemoved.apply(this, arguments);\n  }\n\n  write() {\n    let text = \"\";\n    for (let i = 0; i < arguments.length; ++i) {\n      text += String(arguments[i]);\n    }\n\n    if (this._parsingMode === \"xml\") {\n      throw new DOMException(\"Cannot use document.write on XML documents\", \"InvalidStateError\");\n    }\n\n    if (this._writeAfterElement) {\n      // If called from an script element directly (during the first tick),\n      // the new elements are inserted right after that element.\n      const tempDiv = this.createElement(\"div\");\n      tempDiv.innerHTML = text;\n\n      let child = tempDiv.firstChild;\n      let previous = this._writeAfterElement;\n      const parent = this._writeAfterElement.parentNode;\n\n      while (child) {\n        const node = child;\n        child = child.nextSibling;\n\n        node._isMovingDueToDocumentWrite = true; // hack for script execution\n        parent.insertBefore(node, previous.nextSibling);\n        node._isMovingDueToDocumentWrite = false;\n\n        previous = node;\n      }\n    } else if (this.readyState === \"loading\") {\n      // During page loading, document.write appends to the current element\n      // Find the last child that has been added to the document.\n      if (this.lastChild) {\n        let node = this;\n        while (node.lastChild && node.lastChild.nodeType === NODE_TYPE.ELEMENT_NODE) {\n          node = node.lastChild;\n        }\n        node.innerHTML = text;\n      } else {\n        clearChildNodes(this);\n        parseIntoDocument(text, this);\n      }\n    } else if (text) {\n      clearChildNodes(this);\n      parseIntoDocument(text, this);\n    }\n  }\n\n  writeln() {\n    this.write(...arguments, \"\\n\");\n  }\n\n  // This is implemented separately for Document (which has a _ids cache) and DocumentFragment (which does not).\n  getElementById(id) {\n    if (!this._ids[id]) {\n      return null;\n    }\n\n    // Let's find the first element with where it's root is the document.\n    const matchElement = this._ids[id].find(candidate => {\n      let root = candidate;\n      while (domSymbolTree.parent(root)) {\n        root = domSymbolTree.parent(root);\n      }\n\n      return root === this;\n    });\n\n    return matchElement || null;\n  }\n\n  get referrer() {\n    return this._referrer || \"\";\n  }\n  get lastModified() {\n    return this._lastModified;\n  }\n  get images() {\n    return this.getElementsByTagName(\"IMG\");\n  }\n  get embeds() {\n    return this.getElementsByTagName(\"EMBED\");\n  }\n  get plugins() {\n    return this.embeds;\n  }\n  get links() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => (node._localName === \"a\" || node._localName === \"area\") &&\n                        node.hasAttributeNS(null, \"href\") &&\n                        node._namespaceURI === HTML_NS\n      })\n    });\n  }\n  get forms() {\n    return this.getElementsByTagName(\"FORM\");\n  }\n  get scripts() {\n    return this.getElementsByTagName(\"SCRIPT\");\n  }\n  get anchors() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node._localName === \"a\" &&\n                        node.hasAttributeNS(null, \"name\") &&\n                        node._namespaceURI === HTML_NS\n      })\n    });\n  }\n\n  // The applets attribute must return an\n  // HTMLCollection rooted at the Document node,\n  // whose filter matches nothing.\n  // (It exists for historical reasons.)\n  get applets() {\n    return HTMLCollection.createImpl([], {\n      element: this,\n      query: () => []\n    });\n  }\n\n  open() {\n    let child = domSymbolTree.firstChild(this);\n    while (child) {\n      this.removeChild(child);\n      child = domSymbolTree.firstChild(this);\n    }\n    this._documentElement = null;\n    this._modified();\n    return this;\n  }\n  close(noQueue) {\n    // In some cases like when creating an empty iframe, I want to emit the\n    // events right away to avoid problems if later I asign the property src.\n    if (noQueue) {\n      this.readyState = \"complete\";\n\n      fireAnEvent(\"DOMContentLoaded\", this, undefined, { bubbles: true });\n      fireAnEvent(\"load\", this);\n\n      return;\n    }\n    this._queue.resume();\n\n    const dummyPromise = Promise.resolve();\n\n    const onDOMContentLoad = () => {\n      const doc = this;\n      function dispatchEvent() {\n        // https://html.spec.whatwg.org/#the-end\n        doc.readyState = \"interactive\";\n        fireAnEvent(\"DOMContentLoaded\", doc, undefined, { bubbles: true });\n      }\n\n      return new Promise(resolve => {\n        if (!this._deferQueue.tail) {\n          dispatchEvent();\n          return resolve();\n        }\n\n        this._deferQueue.setListener(() => {\n          dispatchEvent();\n          resolve();\n        });\n\n        return this._deferQueue.resume();\n      });\n    };\n\n    const onLoad = () => {\n      const doc = this;\n      function dispatchEvent() {\n        doc.readyState = \"complete\";\n        fireAnEvent(\"load\", doc);\n      }\n\n      return new Promise(resolve => {\n        if (this._asyncQueue.count() === 0) {\n          dispatchEvent();\n          return resolve();\n        }\n\n        return this._asyncQueue.setListener(() => {\n          dispatchEvent();\n          resolve();\n        });\n      });\n    };\n\n    this._queue.push(dummyPromise, onDOMContentLoad, null);\n    // Set the readyState to 'complete' once all resources are loaded.\n    // As a side-effect the document's load-event will be dispatched.\n    this._queue.push(dummyPromise, onLoad, null, true);\n  }\n\n  getElementsByName(elementName) {\n    return NodeList.createImpl([], {\n      element: this,\n      query: () => domSymbolTree.treeToArray(this, {\n        filter: node => node.getAttributeNS && node.getAttributeNS(null, \"name\") === elementName\n      })\n    });\n  }\n\n  get title() {\n    const { documentElement } = this;\n    let value = \"\";\n\n    if (documentElement && documentElement._localName === \"svg\") {\n      const svgTitleElement = firstChildWithLocalName(documentElement, \"title\", SVG_NS);\n\n      if (svgTitleElement) {\n        value = childTextContent(svgTitleElement);\n      }\n    } else {\n      const titleElement = firstDescendantWithLocalName(this, \"title\");\n\n      if (titleElement) {\n        value = childTextContent(titleElement);\n      }\n    }\n\n    value = stripAndCollapseASCIIWhitespace(value);\n\n    return value;\n  }\n\n  set title(value) {\n    const { documentElement } = this;\n    let element;\n\n    if (documentElement && documentElement._localName === \"svg\") {\n      element = firstChildWithLocalName(documentElement, \"title\", SVG_NS);\n\n      if (!element) {\n        element = this.createElementNS(SVG_NS, \"title\");\n\n        this._insert(element, documentElement.firstChild);\n      }\n\n      element.textContent = value;\n    } else if (documentElement && documentElement._namespaceURI === HTML_NS) {\n      const titleElement = firstDescendantWithLocalName(this, \"title\");\n      const headElement = this.head;\n\n      if (titleElement === null && headElement === null) {\n        return;\n      }\n\n      if (titleElement !== null) {\n        element = titleElement;\n      } else {\n        element = this.createElement(\"title\");\n        headElement._append(element);\n      }\n\n      element.textContent = value;\n    }\n  }\n\n  get dir() {\n    return this.documentElement ? this.documentElement.dir : \"\";\n  }\n  set dir(value) {\n    if (this.documentElement) {\n      this.documentElement.dir = value;\n    }\n  }\n\n  get head() {\n    return this.documentElement ? firstChildWithLocalName(this.documentElement, \"head\") : null;\n  }\n\n  get body() {\n    const { documentElement } = this;\n    if (!documentElement || documentElement._localName !== \"html\" ||\n        documentElement._namespaceURI !== HTML_NS) {\n      return null;\n    }\n\n    return firstChildWithLocalNames(this.documentElement, new Set([\"body\", \"frameset\"]));\n  }\n\n  set body(value) {\n    if (value === null ||\n        value._namespaceURI !== HTML_NS ||\n        (value._localName !== \"body\" && value._localName !== \"frameset\")) {\n      throw new DOMException(\"Cannot set the body to null or a non-body/frameset element\", \"HierarchyRequestError\");\n    }\n\n    const bodyElement = this.body;\n    if (value === bodyElement) {\n      return;\n    }\n\n    if (bodyElement !== null) {\n      bodyElement.parentNode._replace(value, bodyElement);\n      return;\n    }\n\n    const { documentElement } = this;\n    if (documentElement === null) {\n      throw new DOMException(\"Cannot set the body when there is no document element\", \"HierarchyRequestError\");\n    }\n\n    documentElement._append(value);\n  }\n\n  _runPreRemovingSteps(oldNode) {\n    for (const activeNodeIterator of this._workingNodeIterators) {\n      activeNodeIterator._preRemovingSteps(oldNode);\n    }\n  }\n\n  createEvent(type) {\n    const typeLower = type.toLowerCase();\n    const eventWrapper = eventInterfaceTable[typeLower] || null;\n\n    if (!eventWrapper) {\n      throw new DOMException(\"The provided event type (\\\"\" + type + \"\\\") is invalid\", \"NotSupportedError\");\n    }\n\n    const impl = eventWrapper.createImpl([\"\"]);\n    impl._initializedFlag = false;\n    return impl;\n  }\n\n  createProcessingInstruction(target, data) {\n    validateName(target);\n\n    if (data.includes(\"?>\")) {\n      throw new DOMException(\"Processing instruction data cannot contain the string \\\"?>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return ProcessingInstruction.createImpl([], {\n      ownerDocument: this,\n      target,\n      data\n    });\n  }\n\n  // https://dom.spec.whatwg.org/#dom-document-createcdatasection\n  createCDATASection(data) {\n    if (this._parsingMode === \"html\") {\n      throw new DOMException(\"Cannot create CDATA sections in HTML documents\", \"NotSupportedError\");\n    }\n\n    if (data.includes(\"]]>\")) {\n      throw new DOMException(\"CDATA section data cannot contain the string \\\"]]>\\\"\", \"InvalidCharacterError\");\n    }\n\n    return CDATASection.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createTextNode(data) {\n    return Text.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createComment(data) {\n    return Comment.createImpl([], {\n      ownerDocument: this,\n      data\n    });\n  }\n\n  createElement(localName) {\n    validateName(localName);\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    const namespace = this._parsingMode === \"html\" || this.contentType === \"application/xhtml+xml\" ? HTML_NS : null;\n\n    return this._createElementWithCorrectElementInterface(localName, namespace);\n  }\n\n  createElementNS(namespace, qualifiedName) {\n    namespace = namespace !== null ? String(namespace) : namespace;\n\n    const extracted = validateAndExtract(namespace, qualifiedName);\n\n    const element = this._createElementWithCorrectElementInterface(extracted.localName, extracted.namespace);\n    element._prefix = extracted.prefix;\n\n    return element;\n  }\n\n  createDocumentFragment() {\n    return DocumentFragment.createImpl([], { ownerDocument: this });\n  }\n\n  createAttribute(localName) {\n    validateName(localName);\n\n    if (this._parsingMode === \"html\") {\n      localName = asciiLowercase(localName);\n    }\n\n    return generatedAttr.createImpl([], { localName });\n  }\n\n  createAttributeNS(namespace, name) {\n    if (namespace === undefined) {\n      namespace = null;\n    }\n    namespace = namespace !== null ? String(namespace) : namespace;\n\n    const extracted = validateAndExtract(namespace, name);\n    return generatedAttr.createImpl([], {\n      namespace: extracted.namespace,\n      namespacePrefix: extracted.prefix,\n      localName: extracted.localName\n    });\n  }\n\n  // TODO: Add callback interface support to `webidl2js`\n  createTreeWalker(root, whatToShow, filter) {\n    return TreeWalker.createImpl([], { root, whatToShow, filter });\n  }\n\n  createNodeIterator(root, whatToShow, filter) {\n    const nodeIterator = NodeIterator.createImpl([], { root, whatToShow, filter });\n\n    this._workingNodeIterators.push(nodeIterator);\n    while (this._workingNodeIterators.length > this._workingNodeIteratorsMax) {\n      const toInactivate = this._workingNodeIterators.shift();\n      toInactivate._working = false;\n    }\n\n    return nodeIterator;\n  }\n\n  importNode(node, deep) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot import a document node\", \"NotSupportedError\");\n    } else if (ShadowRoot.isImpl(node)) {\n      throw new DOMException(\"Cannot adopt a shadow root\", \"NotSupportedError\");\n    }\n\n    return clone(node, this, deep);\n  }\n\n  // https://dom.spec.whatwg.org/#dom-document-adoptnode\n  adoptNode(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_NODE) {\n      throw new DOMException(\"Cannot adopt a document node\", \"NotSupportedError\");\n    } else if (ShadowRoot.isImpl(node)) {\n      throw new DOMException(\"Cannot adopt a shadow root\", \"HierarchyRequestError\");\n    }\n\n    this._adoptNode(node);\n\n    return node;\n  }\n\n  // https://dom.spec.whatwg.org/#concept-node-adopt\n  _adoptNode(node) {\n    const newDocument = this;\n    const oldDocument = node._ownerDocument;\n\n    const parent = domSymbolTree.parent(node);\n    if (parent) {\n      parent._remove(node);\n    }\n\n    if (oldDocument !== newDocument) {\n      for (const inclusiveDescendant of shadowIncludingInclusiveDescendantsIterator(node)) {\n        inclusiveDescendant._ownerDocument = newDocument;\n      }\n\n      for (const inclusiveDescendant of shadowIncludingInclusiveDescendantsIterator(node)) {\n        if (inclusiveDescendant._adoptingSteps) {\n          inclusiveDescendant._adoptingSteps(oldDocument);\n        }\n      }\n    }\n  }\n\n  get cookie() {\n    return this._cookieJar.getCookieStringSync(this.URL, { http: false });\n  }\n  set cookie(cookieStr) {\n    cookieStr = String(cookieStr);\n    this._cookieJar.setCookieSync(cookieStr, this.URL, {\n      http: false,\n      ignoreError: true\n    });\n  }\n\n  // The clear(), captureEvents(), and releaseEvents() methods must do nothing\n  clear() {}\n\n  captureEvents() {}\n\n  releaseEvents() {}\n\n  get styleSheets() {\n    if (!this._styleSheets) {\n      this._styleSheets = new StyleSheetList();\n    }\n\n    // TODO: each style and link element should register its sheet on creation\n    // and remove it on removal.\n    return this._styleSheets;\n  }\n\n  get hidden() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return false;\n    }\n\n    return true;\n  }\n\n  get visibilityState() {\n    if (this._defaultView && this._defaultView._pretendToBeVisual) {\n      return \"visible\";\n    }\n\n    return \"prerender\";\n  }\n}\n\neventAccessors.createEventAccessor(DocumentImpl.prototype, \"readystatechange\");\nmixin(DocumentImpl.prototype, GlobalEventHandlersImpl.prototype);\nmixin(DocumentImpl.prototype, NonElementParentNodeImpl.prototype);\nmixin(DocumentImpl.prototype, ParentNodeImpl.prototype);\n\nDocumentImpl.prototype._elementBuilders = Object.create(null);\n\nDocumentImpl.prototype.getElementsByTagName = memoizeQuery(function (qualifiedName) {\n  return listOfElementsWithQualifiedName(qualifiedName, this);\n});\n\nDocumentImpl.prototype.getElementsByTagNameNS = memoizeQuery(function (namespace, localName) {\n  return listOfElementsWithNamespaceAndLocalName(namespace, localName, this);\n});\n\nDocumentImpl.prototype.getElementsByClassName = memoizeQuery(function getElementsByClassName(classNames) {\n  return listOfElementsWithClassNames(classNames, this);\n});\n\nmodule.exports = {\n  implementation: DocumentImpl\n};\n"]},"metadata":{},"sourceType":"script"}